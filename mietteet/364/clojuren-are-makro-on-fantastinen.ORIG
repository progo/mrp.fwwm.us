<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Clojuren are-makro on fantastinen</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="clojuren-are-makro-on-fantastinen#content">Siirry sisältöön</a></li>
        <li><a href="clojuren-are-makro-on-fantastinen#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="http://progo.viuhka.fi/kategoria/hifi/">Hifi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/rauta/">Rauta</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/viihde/">Viihde</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize25" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize105" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize31" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/mpd/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">mpd</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize23" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize42" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/opiskelu/index.html" class="tagSizeMedium tagSize17" style="font-size: 100%;">opiskelu</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize34" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">15. joulukuu 2010, 11:28</p>
<h1 class="entry-title"><a rel="bookmark" href="clojuren-are-makro-on-fantastinen">Clojuren are-makro on&#160;fantastinen</a></h1>


<div class="entry-content">
	<p>Toivottavasti suurin osa teistä lukijoista tietää, kuinka kielellänne yksikkötestataan moduuleita. Vanhemmat kielet yleensä kaipaavat erillisiä kirjastoja, ja modernimmat kielet tukevat itsessään yksikkötestailuja. Ainakin Pythonissa on nättejä ratkaisuja sekä kielen että erilliskirjastojen puolesta. Olen kuullut myös Rubyn erinomaisesta, ellei parhaasta testauskirjastosta. Mutta Clojuren testauspuoli on aivan pahuksen erinomainen mielestäni. Se osaa todellakin hämärtää turhaa boilerplatea pois näkyvistä, ja testauskoodi on todellakin testauskoodia!</p>

	<p>Nopeasti mietittynä syitä, miksi Clojuressa on miellyttävämpi kirjoittaa testejä kuin Javassa (verrokkini tässä artikkelissa):</p>

	<ul>
		<li>Dynaaminen tyypitys. Monessa tapauksessa toki testien määrä vähenisi, jos funktioiden palautukset voisi määrätä staattisesti, mutta testailun suhteen on nopeata ainakin kirjoittaa nekin lisätestit</li>
		<li>Dynaaminen kieli. Clojure on Lisp-sukulainen, joten ohjelman lisäksi itse kieltä voi ohjelmoida eteenpäin makroilla. Lisäksi testausympäristön voi toteuttaa <acronym title="Domain Specific Language"><span class="caps">DSL</span></acronym>-kielenä, mikä typistää työtä entisestään</li>
	</ul>

	<p>Clojure tarjoaa siis oman testausympäristön nimiavaruudessa <code>clojure.test</code>. Lyhyt johdatus tavanomaisiin testausmenetelmiin löytyy <a href="http://nakkaya.com/2009/11/18/unit-testing-in-clojure/">tästä artikkelista</a>. Lyhyesti, kun staattisissa kielissä yleensä kirjoitellaan <code>assertFoo</code>-litanioita, clojuressa on simppeli ja näpäkkä <code>is</code>-makro. <code>is</code> ottaa vastaan vain totuusarvon, ja failaa testit, jos totuus on falskia. Tyypillinen esimerkki:</p>

<pre class="clojure">(is (= 2 3)) ;fail
</pre>

	<p>Javassa (JUnit) vastaava voisi olla vaikkapa</p>

<pre class="java">assertTrue(2 == 3); //fail
</pre>

	<p>Jos otamme nyt vähän realistisemman esimerkin, millä tavoin <code>are</code> helpottaa, niin oletetaan, että haluamme testailla kellonaikoja parsivaa funktiota, olkoon sen nimi <code>parse-time</code>. Tehdäksemme tästä vähän vaativampaa, <code>parse-time</code> palauttaa listan sijasta kuvauksen (vai mikähän olisi sopiva suomennos <code>map</code>-tietorakenteille). Nyt toistuva testailu muuttuukin yllättävän työlääksi!</p>

<pre class="clojure">(is (= (parse-time &quot;10:43&quot;) {:hh 10, :mm 43}))
</pre>

	<p>Tokihan tuosta on helppo lukea sinällään, mitä tapahtuu, mutta meidän ei todellakaan tarvitse toistaa yhtään ylimääräistä koodia Clojuressa, jos niin haluamme. Makroilla asia sujuu. Are-makrolle on jo varsin selväsanainen <a href="http://richhickey.github.com/clojure/clojure.test-api.html#clojure.test/are">dokumentaatio</a> olemassa. Haluan tässä nyt selventää, miten sitä kannattaa pikemminkin käyttää, jos vain testauksen kannalta mahdollista. Testataksemme funktiota <code>parse-time</code> vähän kattavammin, <code>is</code>-floodauksen sijaan muodostamme <code>are</code>-kuvauksen, jonka ytimenä toimii lispitön testikoodin sisältö. Vain ulkorakenteissa näemme Clojurea:</p>

<pre class="clojure">(are [hh mm teststr] (= {:hh hh :mm mm} (parse-time teststr))
   ;hh mm string
    12 00 &quot;12&quot;
    12 05 &quot;12:05&quot;
    00 00 &quot;&quot;
    00 00 &quot;:&quot;
    00 15 &quot;:15&quot;
    01 00 &quot;1:&quot;
)
</pre>

	<p>Ja mitä näemme? Meidän tarvitsee kirjoittaa yksi ehtolause, jota sovelletaan argumenteille. Ja ainakin minusta nyt sopivan syntaksivärjäyksen kanssa koodi on superkaunista. </p>

	<p>Oma mielipide? Clojurella päästään vielä pitkälle. Se on nykykielistä ehdottomasti fiksuin valinta, jos kestää funktionaalisen paradigman. </p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/clojure/index.html" rel="tag">clojure</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../363/mpdscribble-meinasi-temppuilla" title="MPDScribble meinasi temppuilla">&#171; MPDScribble meinasi temppuilla</a> 
           &mdash; <a rel="next" href="../365/clojuren-sorted-map-by-on-tyylikas" title="Clojuren kuvaukset ovat tyylikkäitä">Clojuren kuvaukset ovat tyylikkäitä &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../565/mita-on-kehittaa-clojurella">Mitä on kehittää&#160;Clojurella</a></span> &#183; <span class="published">2012-02-05</span>
<br /><span class="smallexcerpt">C- ja muunkielisissä projekteissa tavataan kirjoittaa koodia ensin, ja sitten testataan. Tietysti vaatimus osittain syntyy koodin kääntämisestä; ilman kääntöä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../564/ranskalaisten-viivojen-parsimista-clojurella">Ranskalaisten viivojen parsimista&#160;Clojurella</a></span> &#183; <span class="published">2012-02-02</span>
<br /><span class="smallexcerpt">Kirjoitin männäviikolla kokeilumielessä ohjelman, joka kääntää ranskalaiset viivat Beamer-Latexiksi. Ideana olisi tuottaa esityksen lihapuoli nopeasti rustaamalla tiivistä merkintää ja sitten...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../551/tekijoita-clojurella">Tekijöitä&#160;Clojurella</a></span> &#183; <span class="published">2011-09-17</span>
<br /><span class="smallexcerpt">Nyt olen joutunut opiskelemaan tuota lukuteoriaa ja sen alkeita, ja monet niistä teorioista ovat innoittaneet minulle pieniä Clojure-ohjelmia. Se pää...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../541/levyjen-hakemista-ihmisheuristiikoin">Levyjen hakemista&#160;ihmisheuristiikoin</a></span> &#183; <span class="published">2011-08-04</span>
<br /><span class="smallexcerpt">Omasta musiikkisoittimesta on kai joskus tullut puhuttua. Nyt MPD-aikoina on luonnollista hakea sen sijaan oman MPD-asiakasohjelman pariin. Hitsi kun en...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../529/konffitiedostojen-toteuttamisesta">Konffitiedostojen&#160;toteuttamisesta</a></span> &#183; <span class="published">2011-05-28</span>
<br /><span class="smallexcerpt">Erilaisia rc-tiedostoja (runtime configuration) on vaikka pilvin pimein, ja syitä tähän on monia. Yksi on erilaiset vaatimukset hyvältä konffilta, ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../468/kartanluontia-clojurella">Kartanluontia&#160;Clojurella</a></span> &#183; <span class="published">2011-02-12</span>
<br /><span class="smallexcerpt">Upea kieli tämä Clojure. Tulokset ovat enemmän kuin tyydyttäviä, ja sellainen alkukantainen lisp-häkkäilyn maku on suussa. Ja Javan ansiosta kaikkea...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../365/clojuren-sorted-map-by-on-tyylikas">Clojuren kuvaukset ovat&#160;tyylikkäitä</a></span> &#183; <span class="published">2010-12-18</span>
<br /><span class="smallexcerpt">Tällä kertaa olen ihmetellyt Clojuren erilaisia kuvauksia. Kukaan ei ole valehdellut sanoessaan, että kuvaukset (maps) ovat Clojuren keskeinen tietorakenne. Pelkkä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../360/leiningenin-kayttoonotto">Leiningenin&#160;käyttöönotto</a></span> &#183; <span class="published">2010-12-04</span>
<br /><span class="smallexcerpt">Ajattelin tuoda oman panokseni Leiningen&#8212;Clojure -pöytään, kun nyt on siihen aihetta. Eli nopea opas Leiningenin käyttöön Clojure-projektien hallinnassa! Kirjoitan nimiavaruuksista...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../357/clojure-ja-haskell">Clojure ja&#160;Haskell</a></span> &#183; <span class="published">2010-12-01</span>
<br /><span class="smallexcerpt">Funktionaalinen ohjelmointi; Haskell. Niinhän se on yleensä lukenut, mutta nyt olen tainnut päästä Clojuresta kiinni. Clojure on vain käytännönläheisempi ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../356/leiningen-ja-vimclojure-nyt-yhteiselossa">Leiningen ja Vimclojure nyt&#160;yhteiselossa</a></span> &#183; <span class="published">2010-11-25</span>
<br /><span class="smallexcerpt">Ensin virittelin VimClojuren toimimaan. Sitten mukaan tuli upea pikkuapulainen Leiningen. Leiningen toimii pienenä Maven-ohjaajana, joka erikoistuu sitten Clojuren saloihin. Linkittämäni...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

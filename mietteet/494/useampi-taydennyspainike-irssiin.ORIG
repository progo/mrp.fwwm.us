<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Useampi täydennyspainike Irssiin</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="useampi-taydennyspainike-irssiin#content">Siirry sisältöön</a></li>
        <li><a href="useampi-taydennyspainike-irssiin#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="http://progo.viuhka.fi/kategoria/hifi/">Hifi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/rauta/">Rauta</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/viihde/">Viihde</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize24" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize104" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize30" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/opiskelu/index.html" class="tagSizeMedium tagSize16" style="font-size: 100%;">opiskelu</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeMedium tagSize36" style="font-size: 100%;">palvelin</a></li>
	<li><a href="../../tag/pelaaminen/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">pelaaminen</a></li>
	<li><a href="../../tag/rauta/index.html" class="tagSizeMedium tagSize22" style="font-size: 100%;">rauta</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize33" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">17. helmikuu 2011, 19:00</p>
<h1 class="entry-title"><a rel="bookmark" href="useampi-taydennyspainike-irssiin">Useampi täydennyspainike&#160;Irssiin</a></h1>


<div class="entry-content">
	<p>Tuskailin tässä pienen, mutta merkityksellisen ongelman kanssa: miten irssiin saisi kaksi erilaista täydennystoimintoa. Oletuksenahan vain <code>&lt;Tab&gt;</code> hyväksytään, ja se käy oletuksena irssin omia täydennyksiään, jotka ovat kyllä mainioita. Mutta joskus haluaisi täydennellä muitakin asioita. Kolmannen osapuolen skriptejä on esimerkiksi sanakirjoille ja aiemmin keskustelluille termeille. Ja vain mielikuvitus on rajana sille, mitä voi kirjoittaa täydennysfunktioonsa. Irssiin voi kirjoittaa vähintään yhtä kattavan täydennysfunktion kuin vimin *omni completion*illa on mahdollista saada. En itse jaksanut kirjoittaa omaa täydennystä, mutta esittelen skriptin, jonka avulla käyttäjä voi kutsua irssin sisäänrakennettua täydennystä sekä vapaavalintaisia skriptejään sulassa keskinäisessä sovussa.</p>

	<p>Ratkaisu haki muotoaan aika pitkään, koska Irssin monipuolinen signaalijärjestelmä on aika heikosti dokumentoitu. Esimerkiksi signaalien argumentteja muuttaakseen perliksi täytyy käydä irssin lähdepaketeista hakemassa skripti. Heikko dokumentointi, huono homma. Ellei asia olisi ollut supertärkeä<sup id="fnrev8715706264d5d54cecefee" class="footnote"><a href="useampi-taydennyspainike-irssiin#fn8715706264d5d54cecefee">1</a></sup>, olisi voinut jäädä tekemättäkin.</p>

	<h2>Hyödyt</h2>

	<p>Eli mikä on homman juoni? Mitä käyttäjä hyötyy kahdesta pikanäppäimestä täydennyksiin. No vimiä käyttäneet tietävät (ainakin pitäisi tietää) usean eri kontekstin mukaiset täydennykset ja niiden edut. Irssin kontekstitietäväinen perustäydennys toimii upeasti. Se ainakin osaa </p>

	<ul>
		<li>Täydentää komentoja /-merkin jälkeen</li>
		<li>Osaa täydentää komentoja /help -komennon perään</li>
		<li>Osaa hakea tiedostonimiä /dcc -sendeihin ja esimerkiksi /script load -syötteiksi</li>
		<li>Täydentää tietenkin nimimerkit,
	<ul>
		<li>&#8230; pilkun kanssa, jos nimimerkki tulee rivin alkuun</li>
		<li>.. ilman pilkkua, jos nimimerkin täydentää keskelle riviä</li>
	</ul></li>
		<li>Täydentää kanavanimet</li>
		<li>Hakee topic-nimet täydennyksellä</li>
	</ul>

	<p>Se on uskomaton skripti, ja toimii kivasti. En ole uskaltanut katsoa sen täyttä toteutusta kuitenkaan. Tiedä, minkälaista makaronia tulee putkesta ulos.  Mutta kaikesta tuosta huolimatta se voisi täydentää enemmänkin. Pitkiä sanoja, joita ei jaksaisi kirjoittaa alusta loppuun uudestaan. Ja kopypaste on hidasta. Useimmat tyytyvät mainitsemaan pitkän termin kertaalleen ja sitten käyttämään lyhenteitä, mutta vim-käyttäjät tietävät täydennyksen päälle.</p>

	<p>Ja valmisskriptit, mitä ne tekevät yleensä? Ei niillä ole muita vaihtoehtoja kuin heittäytyä irssi-signaalien jatkoksi, etteivät häiritsisi vakiotäydennystä. Mutta hyödyt katoavat nopeasti olemattomiin, jos en saa täydennettyä jotain sanoja sen takia, kun jonkun käyttäjän nimimerkki syöksyy siihen eteen. Järkevin ratkaisu on saada vim-henkisesti määritellä useita eri näppäimiä eri täydennyksille. Irssin suunnittelussa ei ole otettu tätä vaihtoehtoa vastaan, joten kohtalaisen yritys-erehdys -lenkin jälkeen sain tuloksena toimivan ratkaisun!</p>

<pre class="perl">sub sig_choose_completion {
    my ($complist, $window, $word, $linestart, $want_space) = @_;
    return unless Irssi::settings_get_bool(&quot;omni_completion&quot;);

    (&amp;{&#39;Irssi::Script::irccomplete::sig_complete&#39;}
        ($complist, $window, $word, $linestart, $want_space));
    Irssi::signal_stop();
}

# complete_words gets triggered by user-specified key press. Example usage:
# /bind ^N /omni_complete
sub complete_words {
    Irssi::settings_set_bool(&quot;omni_completion&quot;, 1);
    Irssi::signal_emit(&quot;gui key pressed&quot;, 9); # tab
    Irssi::settings_set_bool(&quot;omni_completion&quot;, 0);
}

Irssi::command_bind(&quot;omni_complete&quot;, \&amp;complete_words, &quot;completion&quot;);
Irssi::settings_add_bool (&quot;Completion&quot;, &quot;omni_completion&quot;, 0);
Irssi::signal_add_first &#39;complete word&#39; =&gt; \&amp;sig_choose_completion;
</pre>

	<p>Lyhyt jööti perliä. Häksäily tapahtuu uuden asetuksen <code>omni_completion</code> totuusarvon lukemisen avulla. Se ei ole käyttäjän käytettäväksi oleva asetus (ehkä siis olisi riittänyt kirjoittaa staattinen muuttuja, en tiedä). Mutta tämän ansiosta voin käyttää tabia kaikkeen tavalliseen irssin tarjoamaan täydentelyyn, ja mielivaltaista näppäintä painettaessa kelpaa sitten käyttäjän määrittelemä täydennysfunktio. Toteutussyistä asia piti tehdä näin: vain nappaamalla signaalin <code>&quot;complete word&quot;</code> saa täydentäjäfunktio kaiken tarpeellisen tiedon. Sen tähden skriptissäni pitää tehdä ja rekisteröidä uusi komento, joka lähettää (luojan kiitos tälle löytyi oma signaali) näppäinpainalluksen, eli käytännössä kutsuu ylempää subia. Mutta irssi täyttää puuttuvat tiedot siinä matkalla. Pelkän komennon <code>/omni_complete</code> kutsuminen riviltä ei auta ketään, mutta tämänpä pystyy nätisti asettamaan haluamansa näppäimen taakse. Minä olen vimistinä valinnut <code>&lt;C-n&gt;</code> -painikkeen; täydennysskriptikseni sitten vastaavan &#8220;buffer complete&#8221; -toimintoa vastaavan viritelmän. Se osaa jopa kuulema korjata typot tilastojen perusteella. Saa nähdä, toimiiko riittävän hyvin.</p>

	<p>Mutta homma toimii. Ja toivon, että joku muukin saa iloa siitä. Eräs suurimmista irssin ongelmista<sup id="fnrev8863509194d5d54ced797f" class="footnote"><a href="useampi-taydennyspainike-irssiin#fn8863509194d5d54ced797f">2</a></sup> on tällä erää korjattu.</p>

	<p id="fn8715706264d5d54cecefee" class="footnote"><sup>1</sup> Huvittavintahan tässä on, että tällä kikkailulla sain käytännössä en yhtään käytännön hyötyjä, koska irkkaan niin vähän ja vähillä kanavilla.</p>

	<p id="fn8863509194d5d54ced797f" class="footnote"><sup>2</sup> Keskustelu tuppaa puutteellisten tekstieditointityökalujen takia muuttumaan kohti puhekielistä. Jos nyt voi kirjoittaa nättejä täydennysfunktioita vaikka siteeraamaan lakikirjaa hakusanojen avulla sulavasti keskustelun ohessa, niin kyllä se parantaa maailmaa ainakin hitusen.</p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/irc/index.html" rel="tag">irc</a>, 
<a href="../../tag/ohjelmointi/index.html" rel="tag">ohjelmointi</a>, 
<a href="../../tag/perl/index.html" rel="tag">perl</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../468/kartanluontia-clojurella" title="Kartanluontia Clojurella">&#171; Kartanluontia Clojurella</a> 
           &mdash; <a rel="next" href="../501/pythonin-multiprocessing" title="Pythonin multiprocessing">Pythonin multiprocessing &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../584/pythonin-vastaisku-lispeille-ipython-ja-vim-ipython">Pythonin vastaisku lispeille: IPython ja vim-ipython</a></span> &#183; <span class="published">2012-07-25</span>
<br /><span class="smallexcerpt">Tai &#8220;Pythonin uusi toivo&#8221; tai &#8220;Pythonin paluu&#8221;. Mistä on kyse? Pythonin tulkin me kaikki kai tiedämme: kaikki siinä periaatteessa on,...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../581/sumitup-puutteet-ja-mihin-suuntaan-edetaan">SumItUp: puutteet ja mihin suuntaan&#160;edetään</a></span> &#183; <span class="published">2012-07-12</span>
<br /><span class="smallexcerpt">Esittelin pari postausta sitten Soulver-kloonin raakileen, SumItUpin. Nyt se on GitHubissa kaikkien pällisteltävänä ja sellaisella raakileasteella, jotta sitä voi jo...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../579/soulver-kloonia-rakentelemassa">Soulver-kloonia&#160;rakentelemassa</a></span> &#183; <span class="published">2012-07-07</span>
<br /><span class="smallexcerpt">Erittäin upealla konseptilla varustettu laskinohjelma Soulver kaatuu siihen, että sen saa vain Mäkille. Vapaamuotoinen näpertelyalusta on usein ainut asia, mitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../566/terminaaleja-vimista-kasin">Terminaaleja Vimistä&#160;käsin</a></span> &#183; <span class="published">2012-02-11</span>
<br /><span class="smallexcerpt">Vanha kunnon ConqueTerm on nyt valmis ja käyttökelpoinen tuote kehittelyyn.

	Olen viime päivinä alkanut käyttää vimiä hyvin emacsmaisesti. Se on tietenkin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../565/mita-on-kehittaa-clojurella">Mitä on kehittää&#160;Clojurella</a></span> &#183; <span class="published">2012-02-05</span>
<br /><span class="smallexcerpt">C- ja muunkielisissä projekteissa tavataan kirjoittaa koodia ensin, ja sitten testataan. Tietysti vaatimus osittain syntyy koodin kääntämisestä; ilman kääntöä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../564/ranskalaisten-viivojen-parsimista-clojurella">Ranskalaisten viivojen parsimista&#160;Clojurella</a></span> &#183; <span class="published">2012-02-02</span>
<br /><span class="smallexcerpt">Kirjoitin männäviikolla kokeilumielessä ohjelman, joka kääntää ranskalaiset viivat Beamer-Latexiksi. Ideana olisi tuottaa esityksen lihapuoli nopeasti rustaamalla tiivistä merkintää ja sitten...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../556/korintaytto-ja-ahne-menetelma">Korintäyttö ja ahne&#160;menetelmä</a></span> &#183; <span class="published">2011-10-23</span>
<br /><span class="smallexcerpt">Mietiskelen tässä korintäyttöä (bin packing) ja sitä, miten ahne menetelmä on joko ylipolynomiaalinen tai sitten epäoptimaalinen.  Luultavasti se on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../551/tekijoita-clojurella">Tekijöitä&#160;Clojurella</a></span> &#183; <span class="published">2011-09-17</span>
<br /><span class="smallexcerpt">Nyt olen joutunut opiskelemaan tuota lukuteoriaa ja sen alkeita, ja monet niistä teorioista ovat innoittaneet minulle pieniä Clojure-ohjelmia. Se pää...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../547/pieni-tiedostolistausapu">Pieni&#160;tiedostolistausapu</a></span> &#183; <span class="published">2011-09-04</span>
<br /><span class="smallexcerpt">Pitäisi viritellä joku zsh-funktio tekemään seuraavanlaisia tiedostolistauksia nykyisestä hakemistosta:

$ ls -1
foo.txt
bar.txt
paperi.tex
vanhapaperi.tex.gz
$ l .txt
foo.txt
bar.txt
$ l peri
paperi.tex
vanhapaperi.tex.gz
$ l v*p
vanhapaperi.tex.gz
$ ls $files
vanhapaperi.tex.gz


	Eli sen...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

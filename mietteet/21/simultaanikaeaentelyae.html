<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Simultaanikääntelyä</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="simultaanikaeaentelyae#content">Siirry sisältöön</a></li>
        <li><a href="simultaanikaeaentelyae#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/598/blogille-idea.html">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly.html">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/596/org-blogaaminen-vaikeata.html">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/595/twitterointia-emacsilla.html">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/594/weboodi-aikataulut-orgiin.html">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita.html">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/592/emacs-has-me.html">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/591/editorien-taistelu-tietamyshallinnassa.html">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/590/think-vimorganizer.html">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/589/think-orgmode.html">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="/kategoria/hifi/">Hifi</a></li>
	<li><a href="/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="/kategoria/rauta/">Rauta</a></li>
	<li><a href="/kategoria/viihde/">Viihde</a></li>
	<li><a href="/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/bash/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">bash</a></li>
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize27" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize107" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize33" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize44" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/opiskelu/index.html" class="tagSizeMedium tagSize19" style="font-size: 100%;">opiskelu</a></li>
	<li><a href="../../tag/rauta/index.html" class="tagSizeMedium tagSize25" style="font-size: 100%;">rauta</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize36" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published"> 7. marraskuu 2009, 19:33</p>
<h1 class="entry-title"><a rel="bookmark" href="simultaanikaeaentelyae">Simultaanikääntelyä</a></h1>


<div class="entry-content">
<p>Olen tässä nyt kaksi viikkoa käynyt kurssia <em>Hajautetut ja samanaikaiset järjestelmät</em>. Aiheena on siis ensisijaisesti järjestelmien hajautus mutta myös samanaikaista ajamista, sekä sen erikoistapausta rinnakkaislaskenta. Koska minulla on tupaydinsuoritin koneessani, ajattelin tehdä vanhan käännösskriptini uudestaan, kun ajatus siihen heräsi kurssin demonäytöksessä.</p>
<p><!--more-->En aivan ole varma, onko yksinkertaista skriptiä alkuperäisessä muodossa järkevää esitellä, mutta koska en ole sitä blogissani käsitellyt, käydään sen konseptit läpi myös.</p>
<h1>Peräkkäisratkaisu</h1>
<p>Linux-käytön alkuvaiheissa oli vähän haastavaa saada flac-tiedostot mp3-soittimessa kuuluviksi mötiköiksi. Käytin silloin yksittäistiedostoihin ihan alkeellista putkitusta:</p>
<pre>flac -cd flac | lame - mp3</pre>
<p>Tässä siis käytetään flac-dekooderia purkamaan PCM-virraksi flaccia, ja putkitetaan tulos lamelle, joka on paras kokeilemani MP3-enkooderi. Tämä siis lukee syötevirrasta ja tulostaa tiedostoon. Tämä on alkeellisin versio, ja toimii sinänsä hyvin, mutta jättää esimerkiksi tagit pois ja on muutenkin vähän heikko albumien kääntelyssä. Peräkkäisratkaisussa mennään siis tähän suuntaan:</p>
<pre>for arg in "$@"
do
  flac -cd $arg | lame - $arg.mp3
done</pre>
<p>Ja tuohon enää heitetään tunnistetietojen kaivaminen (kukin tieto otetaan kierroksella ylös lähdetiedostosta ja käytetään lamen komentoriviparametreja niiden uudelleensijoittamiseen. Käytän tietojen kaivamiseen taginfo-ohjelmaa) niin homma on valmis. Valmis lopputulos, jota olen vuosia jo käytellyt, <a href="../../huttua/flac-to-mp3.sh" target="_blank">on ohessa</a>.</p>
<p>Periaatteessa myös tämä peräkkäisratkaisu on samanaikainen, sillä sekä de- että enkoodaus tehdään yhtaikaisesti. Kuitenkin tämä ratkaisu varaa vain yhden ytimen: dekoodaus ei paljoa syö.</p>
<h1>Samanaikainen ratkaisu</h1>
<p>Samanaikainen ratkaisu syntyy joko vaikeasti tai helposti kikkailemalla. Olen ajatellut rinnakkaistamista jo pitkään, mutta vasta kun opettaja sivumainintana kertoi, kuinka hän oli toteuttanut vastaavan systeemin, päätin kopioida mallia edelleen omaan käyttöön. Tulos on myös siistimpi kuin ensimmäinen versio.</p>
<p>Ensin luodaan peräkkäisratkaisun tavoin silmukassa käännettävien tiedostojen listat, tagit ja muut. Mutta nyt nokkelana ei komenneta suoritettavia ohjelmia toimimaan heti, vaan muodostetaan merkkijonot, joissa esiintyvät ajettavat komennot!</p>
<pre>buildlist=()      # taulukko
i=0               # kierrosmuuttuja
for arg in <span style="color: #ffff99;">"$@"</span>
do
  buildlist[$i]=<span style="color: #ffff99;">"flac -cd $arg | lame - $arg.mp3"</span>
  let i=i+1
done</pre>
<p>Pseudohko bash-koodi ei käänny sellaisenaan, mutta idea tullee selväksi. Manuaalista syntaksiväritystä hyväksikäyttäen korostan sitä seikkaa, että nyt tallennetaan täsmälleen sellaiset komentorivit ylös, jotka voisi kopypastettaa sitten bash-istuntoon.</p>
<p>Syntyvä taulukko sisältää siis tiedostot, kukin tiedosto rivillään. Jaetaan tämä sitten kahdeksi eri osataulukoksi. On muuten syytä muistaa lisätä rivinvaihtomerkit "\n" kunkin taulukon jäsenen perään tai eteen. Tai lisätä puolipilkut komentojen erottamiseksi toisistaan.</p>
<pre>let splitpoint=`echo "${#buildlist[*]} / 2"|bc`
firsthalf=${buildlist[@]:0:$splitpoint}
secondhalf=${buildlist[@]:$splitpoint}</pre>
<p>Taulukoiden indekseillä kikkaileminen tuohon tyyliin on vähän epäselvää. Siinä siis on eräänlainen operaattori, joka palauttaa buildlist-taulukon jäsenet nollasta splitpointtiin asti. Ja kolmas rivi sisältää vastaavan systeemin pisteestä loppuun asti. <a href="http://tldp.org/LDP/abs/html/arrays.html" target="_blank">Oppaista lisätietoa</a>.</p>
<p>Bash voi suorittaa skriptiä suoraan syötevirrasta, joten lopuksi nätisti laitamme suorittimen lämpenemään:</p>
<pre>echo -e $firsthalf | bash &amp;
echo -e $secondhalf | bash</pre>
<p>Ja sehän toimii kivasti. Tämmöisessä simultaaniajelussa kannattaa suosiolla laittaa kaikki oheisohjelmat hiljaisiksi, jotta esimerkiksi jatkuvasti päivittyvä prosenttilukema ei mene sekaisin. Lisäsin itse kunkin käännöksen alkuun yhden echo-lauseen ilmaisemaan uuden kappaleen kääntämisen aloittamista. Tulos on, mitä pitääkin. Lopullinen koodi interaktiivisen laatukyselyn kanssa <a href="../../huttua/Flac-to-mp3ip.sh" target="_blank">täältä</a>.</p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/bash/index.html" rel="tag">bash</a>, 
<a href="../../tag/ohjelmointi/index.html" rel="tag">ohjelmointi</a>, 
<a href="../../tag/skriptaus/index.html" rel="tag">skriptaus</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../22/hyvae-musiikki-ja-sen-komponentit" title="Hyvä musiikki ja sen komponentit">&#171; Hyvä musiikki ja sen komponentit</a> 
           &mdash; <a rel="next" href="../20/rakenteisuuden-peraessae" title="Rakenteisuuden perässä">Rakenteisuuden perässä &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../590/think-vimorganizer">Think&#160;VimOrganizer.</a></span> &#183; <span class="published">2012-09-02</span>
<br /><span class="smallexcerpt">Asiat rullaavat eteenpäin tyydyttävää tahtia tämän uuden tiedonhallinnan kanssa. Nyt olen säätänyt kuntoon jokaisesta kulmasta toimivan org-capture -variantin, jolla saan...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../584/pythonin-vastaisku-lispeille-ipython-ja-vim-ipython">Pythonin vastaisku lispeille: IPython ja vim-ipython</a></span> &#183; <span class="published">2012-07-25</span>
<br /><span class="smallexcerpt">Tai &#8220;Pythonin uusi toivo&#8221; tai &#8220;Pythonin paluu&#8221;. Mistä on kyse? Pythonin tulkin me kaikki kai tiedämme: kaikki siinä periaatteessa on,...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../581/sumitup-puutteet-ja-mihin-suuntaan-edetaan">SumItUp: puutteet ja mihin suuntaan&#160;edetään</a></span> &#183; <span class="published">2012-07-12</span>
<br /><span class="smallexcerpt">Esittelin pari postausta sitten Soulver-kloonin raakileen, SumItUpin. Nyt se on GitHubissa kaikkien pällisteltävänä ja sellaisella raakileasteella, jotta sitä voi jo...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../579/soulver-kloonia-rakentelemassa">Soulver-kloonia&#160;rakentelemassa</a></span> &#183; <span class="published">2012-07-07</span>
<br /><span class="smallexcerpt">Erittäin upealla konseptilla varustettu laskinohjelma Soulver kaatuu siihen, että sen saa vain Mäkille. Vapaamuotoinen näpertelyalusta on usein ainut asia, mitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../571/tv-saato-on-nyt-valmis">TV-säätö on nyt&#160;valmis</a></span> &#183; <span class="published">2012-03-23</span>
<br /><span class="smallexcerpt">No niin. Uuden NVidia-kortin ansiosta TV-episodi on käsitelty voitokkaasti. Jos rahalla asiasta selviämistä ei lasketa huijaamiseksi.

	Oppirahoja tuli taas tosiaankin hassattua....</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../569/satunnaiset-jazzit-soittolistalta">Satunnaiset jazzit&#160;soittolistalta</a></span> &#183; <span class="published">2012-03-18</span>
<br /><span class="smallexcerpt">Jonkin aikaa sitten kirjailin nopean bash-skriptin, joka hakee haluamastaan MPD-soittolistasta tietyn verran kappaleita. Siten, että musiikkia saadaan noin tietyn aikarajan...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../566/terminaaleja-vimista-kasin">Terminaaleja Vimistä&#160;käsin</a></span> &#183; <span class="published">2012-02-11</span>
<br /><span class="smallexcerpt">Vanha kunnon ConqueTerm on nyt valmis ja käyttökelpoinen tuote kehittelyyn.

	Olen viime päivinä alkanut käyttää vimiä hyvin emacsmaisesti. Se on tietenkin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../565/mita-on-kehittaa-clojurella">Mitä on kehittää&#160;Clojurella</a></span> &#183; <span class="published">2012-02-05</span>
<br /><span class="smallexcerpt">C- ja muunkielisissä projekteissa tavataan kirjoittaa koodia ensin, ja sitten testataan. Tietysti vaatimus osittain syntyy koodin kääntämisestä; ilman kääntöä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../564/ranskalaisten-viivojen-parsimista-clojurella">Ranskalaisten viivojen parsimista&#160;Clojurella</a></span> &#183; <span class="published">2012-02-02</span>
<br /><span class="smallexcerpt">Kirjoitin männäviikolla kokeilumielessä ohjelman, joka kääntää ranskalaiset viivat Beamer-Latexiksi. Ideana olisi tuottaa esityksen lihapuoli nopeasti rustaamalla tiivistä merkintää ja sitten...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

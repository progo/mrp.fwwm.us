<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Git-repon aktiivisuus graafiksi</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="git-repon-aktiivisuus-graafiksi#content">Siirry sisältöön</a></li>
        <li><a href="git-repon-aktiivisuus-graafiksi#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="http://progo.viuhka.fi/kategoria/hifi/">Hifi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/rauta/">Rauta</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/viihde/">Viihde</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize26" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/emacs/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">emacs</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize106" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize32" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeMedium tagSize38" style="font-size: 100%;">palvelin</a></li>
	<li><a href="../../tag/pelaaminen/index.html" class="tagSizeMedium tagSize3" style="font-size: 100%;">pelaaminen</a></li>
	<li><a href="../../tag/python/index.html" class="tagSizeMedium tagSize2" style="font-size: 100%;">python</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize35" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">15. elokuu 2011, 17:09</p>
<h1 class="entry-title"><a rel="bookmark" href="git-repon-aktiivisuus-graafiksi">Git-repon aktiivisuus&#160;graafiksi</a></h1>


<div class="entry-content">
	<p>Tässä erilaisten projektien loukussa löysin itselleni pienen hengähdystauon kirjoittaessani <code>bash-gnuplot</code> -kaksikon, missä tutkin git-repojen aktiivisuutta graafin muodossa. Varmaan <code>git gui</code> tai <code>tig</code> hoitaa saman asian, mitä tämä, mutta otin tämän ihan mielenkiinnolla vastaan.</p>

	<p>Pitäisiköhän koodia vähän tutkiskella? Keskeinen ongelma oli saada gnuplot tekemään oikeannäköistä graafia. Sitä pohdin jo kuukausi sitten <a href="http://stackoverflow.com/questions/6563251/">kysymyksessäni StackOverflow&#8217;ssa</a>. Kuten näette, gnuplot ei siihen taivu. En myöskään silloin jaksanut uhrata aikaani awkin kanssa säätämiseen.</p>

	<p>Nyt kuitenkin jaksoin, ja sain jotain aikaiseksi. Parin päivän mittaan screenin ja vimin upean ScreenSend -skriptin avulla oli mukava työstää. Koodi on sievästi etenevää sorttia, joten sen voi esitellä sellaisenaan paloissa:</p>

<pre class="bash">#!/bin/bash
# nice graph out of git repo commits

tempfile=`mktemp`

# obtain the first and last date:
read -a dates &lt;&lt;&lt; &quot;`git log --format=&quot;%ci&quot;|awk &#39;{printf &quot;%s &quot;, $1}&#39;`&quot;
startdate=${dates[ ((${#dates[@]} - 1)) ]}
enddate=${dates[0]}
</pre>

	<p>Ensimmäinen vaihe on luoda temppitiedosto ja ottaa repon ensimmäinen ja viimeinen aktiivinen päivä ylös. Tämän saan bash-taulukkoon, josta kryptisellä haulla haetaan taulukon viimeinen arvo aloituspäiväksi. Lopetuspäiväkin valitaan sieltä.</p>

	<p>Nyt ideana on generoida päivämääriä aloitus- ja lopetusajan peittämiseksi, koska gnuplot ei itse osaa:</p>

<pre class="bash"># generate day entries of zero
for d in $(seq $(date +%s -d $startdate) 86400 $(date +%s -d $enddate)) ; do
    date &quot;+%F%t0%t0&quot; -d @$d
done &gt; $tempfile
</pre>

	<p>Unix-timestamppien kanssa päivämäärälaskenta on onneksi suoraviivaista. Tuloste on muotoa</p>

<pre>pvm         lisäykset  deletiot
2010-01-01  0          0
</pre>

	<p>Ja nämä ovat aina nollia näissä bogussyötteissä: myöhemmin nimittäin kasaamme kaikki saman päivän sisällä tehdyt kommitit yhteen siisteyssyistä. Nyt haetaan varsinaiset tulosteet, jotka muotoillaan ylläolevaan muotoon awkin avulla näppärästi:</p>

<pre class="bash"># append the actual git commits, do some parsing
git log --date=short --shortstat|awk &#39;
/^Date:/ {
    printf &quot;%s&quot;, $2
}
/^.+ files changed/ {
    print &quot;\t&quot; $4 &quot;\t&quot; $6
}&#39; &gt;&gt; $tempfile
</pre>

	<p>Git log ottaa vastaan myös kustomoituja syötemuotoja, mutta niissä muodoissa ei ole mahdollista saada lisäyksiä ja poistoja (<code>--shortstat</code>) mukaan. Siispä käytämme tätä ratkaisua. Nyt tiedostossa <code>$tempfile</code> on paljon päivämääriä tyhjin tilastoin, sekä oikeita tilastoja. Karsimme näistä nyt summariikin, kunhan muistamme lajitella tiedoston ensin&#8230;</p>

<pre class="bash"># gotta create a new tempfile
finaldata=`mktemp`

# now let awk combine entries 
sort $tempfile | awk &#39;
{
    if($1 != olddate) {
        print olddate &quot;\t&quot; ins &quot;\t&quot; dels
        olddate = $1
        ins = 0
        dels = 0
    }
    ins += $2
    dels += $3
}
END{
    print olddate &quot;\t&quot; ins &quot;\t&quot; dels
}&#39; &gt; $finaldata
</pre>

	<p>Uusi temppitiedosto tuntui olevan ainut järkevä vaihtoehto tähän. Lisäksi piti kirjoittaa epäelegantti <span class="caps">END</span>-lauseke loppuun, kun muuten olisi pitänyt vähän miettiäkin. Nyt meillä on tiedostossa <code>$finaldata</code> lajiteltu katsaus kutakin päivää. Arpomisen ja tarkastelujen perästä se näyttää toimivan: summat täsmäävät ja kaikkia päiviä löytyy, vaikka sitten nollatilastoin.</p>

	<p>Gnuplot on viimeinen etappi matkallamme:</p>

<pre class="bash"># finally, the graph

gnuplot -persist &lt;&lt;EOF
set xdata time
set timefmt &quot;%Y-%m-%d&quot;
set xtics rotate format &quot;%Y-%m&quot;
set style data boxes
set style fill solid
set object rectangle from screen 0,0 to screen 1,1 behind fc rgb &quot;gray&quot;
set grid
plot &#39;$finaldata&#39; using 1:2 t &quot;ins&quot;  lt rgb &quot;green&quot;, \
     &#39;$finaldata&#39; using 1:3 t &#39;dels&#39; lt rgb &quot;red&quot;
EOF

rm &quot;$tempfile&quot;
rm &quot;$finaldata&quot;
</pre>

	<p>Tyypillistä gnuplot-magiaa, ei sen kummempaa. Tuloksissa pylväät jotenkin oudosti hyppivät, mutta voi johtua paljosta muustakin. Tämä kokonaisuus ei välttämättä anna hyvää kuvaa koko reposta, koska eri branchit jäävät käsittääkseni logien varassa piiloon. Omiin projekteihini ehkä kannustimeksi kuitenkin ihan kiva.</p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/bash/index.html" rel="tag">bash</a>, 
<a href="../../tag/git/index.html" rel="tag">git</a>, 
<a href="http://progo.viuhka.fi/tag/gnuplot/" rel="tag">gnuplot</a>, 
<a href="../../tag/ohjelmointi/index.html" rel="tag">ohjelmointi</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../541/levyjen-hakemista-ihmisheuristiikoin" title="Levyjen hakemista ihmisheuristiikoin">&#171; Levyjen hakemista ihmisheuristiikoin</a> 
           &mdash; <a rel="next" href="../543/staattiset-kielet-kiinnostavat" title="Staattiset kielet kiinnostavat">Staattiset kielet kiinnostavat &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../590/think-vimorganizer">Think&#160;VimOrganizer.</a></span> &#183; <span class="published">2012-09-02</span>
<br /><span class="smallexcerpt">Asiat rullaavat eteenpäin tyydyttävää tahtia tämän uuden tiedonhallinnan kanssa. Nyt olen säätänyt kuntoon jokaisesta kulmasta toimivan org-capture -variantin, jolla saan...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../584/pythonin-vastaisku-lispeille-ipython-ja-vim-ipython">Pythonin vastaisku lispeille: IPython ja vim-ipython</a></span> &#183; <span class="published">2012-07-25</span>
<br /><span class="smallexcerpt">Tai &#8220;Pythonin uusi toivo&#8221; tai &#8220;Pythonin paluu&#8221;. Mistä on kyse? Pythonin tulkin me kaikki kai tiedämme: kaikki siinä periaatteessa on,...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../581/sumitup-puutteet-ja-mihin-suuntaan-edetaan">SumItUp: puutteet ja mihin suuntaan&#160;edetään</a></span> &#183; <span class="published">2012-07-12</span>
<br /><span class="smallexcerpt">Esittelin pari postausta sitten Soulver-kloonin raakileen, SumItUpin. Nyt se on GitHubissa kaikkien pällisteltävänä ja sellaisella raakileasteella, jotta sitä voi jo...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../579/soulver-kloonia-rakentelemassa">Soulver-kloonia&#160;rakentelemassa</a></span> &#183; <span class="published">2012-07-07</span>
<br /><span class="smallexcerpt">Erittäin upealla konseptilla varustettu laskinohjelma Soulver kaatuu siihen, että sen saa vain Mäkille. Vapaamuotoinen näpertelyalusta on usein ainut asia, mitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../571/tv-saato-on-nyt-valmis">TV-säätö on nyt&#160;valmis</a></span> &#183; <span class="published">2012-03-23</span>
<br /><span class="smallexcerpt">No niin. Uuden NVidia-kortin ansiosta TV-episodi on käsitelty voitokkaasti. Jos rahalla asiasta selviämistä ei lasketa huijaamiseksi.

	Oppirahoja tuli taas tosiaankin hassattua....</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../569/satunnaiset-jazzit-soittolistalta">Satunnaiset jazzit&#160;soittolistalta</a></span> &#183; <span class="published">2012-03-18</span>
<br /><span class="smallexcerpt">Jonkin aikaa sitten kirjailin nopean bash-skriptin, joka hakee haluamastaan MPD-soittolistasta tietyn verran kappaleita. Siten, että musiikkia saadaan noin tietyn aikarajan...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../566/terminaaleja-vimista-kasin">Terminaaleja Vimistä&#160;käsin</a></span> &#183; <span class="published">2012-02-11</span>
<br /><span class="smallexcerpt">Vanha kunnon ConqueTerm on nyt valmis ja käyttökelpoinen tuote kehittelyyn.

	Olen viime päivinä alkanut käyttää vimiä hyvin emacsmaisesti. Se on tietenkin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../565/mita-on-kehittaa-clojurella">Mitä on kehittää&#160;Clojurella</a></span> &#183; <span class="published">2012-02-05</span>
<br /><span class="smallexcerpt">C- ja muunkielisissä projekteissa tavataan kirjoittaa koodia ensin, ja sitten testataan. Tietysti vaatimus osittain syntyy koodin kääntämisestä; ilman kääntöä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../564/ranskalaisten-viivojen-parsimista-clojurella">Ranskalaisten viivojen parsimista&#160;Clojurella</a></span> &#183; <span class="published">2012-02-02</span>
<br /><span class="smallexcerpt">Kirjoitin männäviikolla kokeilumielessä ohjelman, joka kääntää ranskalaiset viivat Beamer-Latexiksi. Ideana olisi tuottaa esityksen lihapuoli nopeasti rustaamalla tiivistä merkintää ja sitten...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

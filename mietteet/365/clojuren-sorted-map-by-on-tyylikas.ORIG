<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Clojuren kuvaukset ovat tyylikkäitä</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="clojuren-sorted-map-by-on-tyylikas#content">Siirry sisältöön</a></li>
        <li><a href="clojuren-sorted-map-by-on-tyylikas#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="http://progo.viuhka.fi/kategoria/hifi/">Hifi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/rauta/">Rauta</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/viihde/">Viihde</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize22" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize102" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize28" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize20" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/ohjelmistot/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">ohjelmistot</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize39" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeMedium tagSize34" style="font-size: 100%;">palvelin</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize31" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">18. joulukuu 2010, 18:59</p>
<h1 class="entry-title"><a rel="bookmark" href="clojuren-sorted-map-by-on-tyylikas">Clojuren kuvaukset ovat&#160;tyylikkäitä</a></h1>


<div class="entry-content">
	<p>Tällä kertaa olen ihmetellyt Clojuren erilaisia kuvauksia. Kukaan ei ole valehdellut sanoessaan, että kuvaukset (maps) ovat Clojuren keskeinen tietorakenne. Pelkkä tavallinen kuvaus, syntaksiltaan <code>{}</code>, on todella yleiskäyttöinen, kun käytellään sopivasti avainsanoja. Nykyinen parserointiskriptinikin hyödyntää melko sulavasti kuvauksia ja sisäkkäisiä sellaisia, kaikki identifioituna avainsanoilla. Käytännössä kyse on staattisten systeemien <em>struct</em>-rakenteista, mutta nyt muuttujanimet tietueiden sisällä ovat varsin vapaasti käsiteltävissä.</p>

	<p>Pelkkien tavallisten kuvausten lisäksi Clojure tuo huisin helpossa muodossa koodaajiensa eteen myös paljon käytetyt järjestetyt kuvaukset. Nämä kuvaukset (<code>sorted-map</code>) pitävät sisältönsä avaimen mukaisessa järjestyksessä. Erittäin hyviä. Avainsanat (jotka ovat siis muotoa <code>:foo</code>) käsitellään merkkijonoina, ja laitetaan leksikograafiseen järjestykseensä. </p>

	<h2>Viikonpäivät järjestykseen</h2>

	<p>Nytpä tuli tarvetta saada kuvaus mielivaltaiseen järjestykseen. Kuvauksen avaimina ovat järjestetyt parit (ja Clojuren tapauksessa vektorit), jotka koostuvat viikonpäivästä ja tunnista. Koska viikonpäivät eivät ole ainakaan Suomessa leksikograafisessa järjestyksessä, pitäisi keksiä funktio, joka järjestelee ne siten.</p>

	<p>Naiivi, toimiva pohja järjestellä viikonpäivät oikeassa järjestyksessä on seuraava:</p>

<pre class="clojure">(defn compare-weekdays
  [k1 k2]
  (let [weekday (zipmap [:ma :ti :ke :to :pe :la :su] (range 8))]
    (compare (weekday k1) (weekday k2))))
</pre>

	<p>Nyt Clojuren oma <code>compare</code>-funktio hoitaa vaativan yhtäsuuruuspuolen alta pois. Se vastaa ikään kuin Javan <code>compareTo</code>-metodia. Koska kuvaukset ovat omien avaintensa funktioita, esimerkiksi <code>weekday :ke</code> palauttaa kakkosen ja <code>weekday :su</code> kuutosen. Hmm, olenkin vahingossa jättänyt <code>range</code>-funktiolle yhtä liian ison lukuvälin. No, onneksi <code>zipmap</code> lopettaa lyhimmän joukon osuessa loppuunsa. Muissa kielissä, kuten Haskellissa <code>zip</code>-tyyppiset funktiot yleensä palauttavat listan järjestettyjä pareja, mutta Clojuren tapauksessa kuvauksen palauttaminen on enemmän kuin loogista. Sitä voi sitten käyttää funktiona välittömästi!</p>

	<p>Mutta en ollut tyytyväinen funktioomme. Haluaisin yleistetyn version, joka ottaisi vastaan listan avainsanoja ja palauttaisi sitten sopivan vertailufunktion. Ja, koska Clojure on funktionaalinen kieli, ei ensimmäisen esimerkin muokkaaminen sopivaksi ollut liian työlästä. Lisäksi pieni Haskell-tuntemus auttaa:</p>

<pre class="clojure">(defn keywords-in-order
  [keywords] 
  (let [k (zipmap (seq keywords) (iterate inc 0))]
    (fn [k1 k2]
      (compare (k k1) (k k2)))))
</pre>

	<p>Edelleen samaa vanhaa, mutta nyt <code>keywords</code>-lista voi olla miten pitkä tahansa, meidän pitää saada naitettua jokaiselle oma kasvava lukuarvonsa. <code>(iterate inc 0)</code> tuottaa meille äärettömän listan lukuja alkaen nollasta, mutta edelleen <code>zipmap</code> lopettaa uusien lukujen ottamisen, kun <code>keywords</code> ehtyy.</p>

	<p>Ahhh. Funktionaalinen ohjelmointi. Clojure on juuri oikeata myrkkyä mielelleni. Clojure on Java ei vain steroideissa, vaan myös hapoissa (mistä S-lausekkeet). Uusi funktiomme <code>keywords-in-order</code> ottaa vastaan vain joukon alkioita (mielellään avainsanoja, muista atomeista en ole varma) ja se palauttaa uuden funktion, joka toimii vertailijana. Nyt funktion <code>compare-weekdays</code> pitäisi olla täsmälleen sama kuin <code>(keywords-in-order [:ma :ti :ke :to :pe :la :su])</code>.  Siis kummatkin funktioita, jotka tekevät saman samoilla syötteillä.</p>

	<h2>Entäs ne kuvaukset?</h2>

	<p>Niin, nyt meillä on ainakin vertailufunktio, joka sanoo, että <code>:ma</code> &lt; <code>:to</code>. Meidän pitänee (en ole aivan varma) kirjoittaa oma vertailufunktio myös kattamaan käyttämämme kuvauksen vektorit <code>[:day time]</code>. Clojuren oma comparator osaa kyllä vertailla, jos vektorin kaikki alkiot vastaavat toisiaan pareittain, ja ovat vertailtavissa. Koska meillä on nyt oma kustomoitu vertailija, on luultavasti tarpeen kirjoittaa oma vektorien vertailija. Sen pidemmittä puheitta:</p>

<pre class="clojure">(defn compare-times
  [[day1 time1]
   [day2 time2]]
  (let [comparator (keywords-in-order [:ma :ti :ke :to :pe :la :su])]
    (if-not (= day1 day2)
      (comparator day1 day2)
      (compare time1 time2))))
</pre>

	<p>Nyt tärkeintä on huomata, että olen määritellyt <code>comparator</code>-funktion edellisessä kappaleessa määritellyllä <code>keywords-in-order</code>-funktiolla, joka palauttaa meille sopivan vertailijan. Iffin laitoin näemmä &#8220;väärinpäin&#8221;, mutta muuten ok. Tämä funktio saa vain kaksi arvoa, mutta käytän <em>destructure</em> -menetelmää purkamaan nämä parametrit auki. Viimeisellä rivillä voi käyttää Clojuren omaa <code>compare</code>-funktiota, koska <code>time1</code> ja <code>time2</code> ovat kokonaislukuja.</p>

	<p>Ja mitä näistä saa auki? No:</p>

<pre class="clojure">(into (sorted-map-by compare-times)
       {[:pe 10] &quot;tunti&quot;
        [:ti 12] &quot;demo&quot;
        [:ti 13] &quot;lounas&quot;
        [:ma 8] &quot;herätys&quot;})
; tulos:
   {[:ma 8] &quot;herätys&quot;,
    [:ti 12] &quot;demo&quot;,
    [:ti 13] &quot;lounas&quot;,
    [:pe 10] &quot;tunti&quot;}
</pre>

	<p>Kaikki on nyt nätisti järjestyksessä! </p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/clojure/index.html" rel="tag">clojure</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../364/clojuren-are-makro-on-fantastinen" title="Clojuren are-makro on fantastinen">&#171; Clojuren are-makro on fantastinen</a> 
           &mdash; <a rel="next" href="../366/sporkhack" title="Sporkhack">Sporkhack &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../565/mita-on-kehittaa-clojurella">Mitä on kehittää&#160;Clojurella</a></span> &#183; <span class="published">2012-02-05</span>
<br /><span class="smallexcerpt">C- ja muunkielisissä projekteissa tavataan kirjoittaa koodia ensin, ja sitten testataan. Tietysti vaatimus osittain syntyy koodin kääntämisestä; ilman kääntöä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../564/ranskalaisten-viivojen-parsimista-clojurella">Ranskalaisten viivojen parsimista&#160;Clojurella</a></span> &#183; <span class="published">2012-02-02</span>
<br /><span class="smallexcerpt">Kirjoitin männäviikolla kokeilumielessä ohjelman, joka kääntää ranskalaiset viivat Beamer-Latexiksi. Ideana olisi tuottaa esityksen lihapuoli nopeasti rustaamalla tiivistä merkintää ja sitten...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../551/tekijoita-clojurella">Tekijöitä&#160;Clojurella</a></span> &#183; <span class="published">2011-09-17</span>
<br /><span class="smallexcerpt">Nyt olen joutunut opiskelemaan tuota lukuteoriaa ja sen alkeita, ja monet niistä teorioista ovat innoittaneet minulle pieniä Clojure-ohjelmia. Se pää...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../541/levyjen-hakemista-ihmisheuristiikoin">Levyjen hakemista&#160;ihmisheuristiikoin</a></span> &#183; <span class="published">2011-08-04</span>
<br /><span class="smallexcerpt">Omasta musiikkisoittimesta on kai joskus tullut puhuttua. Nyt MPD-aikoina on luonnollista hakea sen sijaan oman MPD-asiakasohjelman pariin. Hitsi kun en...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../529/konffitiedostojen-toteuttamisesta">Konffitiedostojen&#160;toteuttamisesta</a></span> &#183; <span class="published">2011-05-28</span>
<br /><span class="smallexcerpt">Erilaisia rc-tiedostoja (runtime configuration) on vaikka pilvin pimein, ja syitä tähän on monia. Yksi on erilaiset vaatimukset hyvältä konffilta, ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../468/kartanluontia-clojurella">Kartanluontia&#160;Clojurella</a></span> &#183; <span class="published">2011-02-12</span>
<br /><span class="smallexcerpt">Upea kieli tämä Clojure. Tulokset ovat enemmän kuin tyydyttäviä, ja sellainen alkukantainen lisp-häkkäilyn maku on suussa. Ja Javan ansiosta kaikkea...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../364/clojuren-are-makro-on-fantastinen">Clojuren are-makro on&#160;fantastinen</a></span> &#183; <span class="published">2010-12-15</span>
<br /><span class="smallexcerpt">Toivottavasti suurin osa teistä lukijoista tietää, kuinka kielellänne yksikkötestataan moduuleita. Vanhemmat kielet yleensä kaipaavat erillisiä kirjastoja, ja modernimmat kielet tukevat...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../360/leiningenin-kayttoonotto">Leiningenin&#160;käyttöönotto</a></span> &#183; <span class="published">2010-12-04</span>
<br /><span class="smallexcerpt">Ajattelin tuoda oman panokseni Leiningen&#8212;Clojure -pöytään, kun nyt on siihen aihetta. Eli nopea opas Leiningenin käyttöön Clojure-projektien hallinnassa! Kirjoitan nimiavaruuksista...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../357/clojure-ja-haskell">Clojure ja&#160;Haskell</a></span> &#183; <span class="published">2010-12-01</span>
<br /><span class="smallexcerpt">Funktionaalinen ohjelmointi; Haskell. Niinhän se on yleensä lukenut, mutta nyt olen tainnut päästä Clojuresta kiinni. Clojure on vain käytännönläheisempi ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../356/leiningen-ja-vimclojure-nyt-yhteiselossa">Leiningen ja Vimclojure nyt&#160;yhteiselossa</a></span> &#183; <span class="published">2010-11-25</span>
<br /><span class="smallexcerpt">Ensin virittelin VimClojuren toimimaan. Sitten mukaan tuli upea pikkuapulainen Leiningen. Leiningen toimii pienenä Maven-ohjaajana, joka erikoistuu sitten Clojuren saloihin. Linkittämäni...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

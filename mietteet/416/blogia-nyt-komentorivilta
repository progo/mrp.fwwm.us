<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Blogia nyt komentoriviltä</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="blogia-nyt-komentorivilta#content">Siirry sisältöön</a></li>
        <li><a href="blogia-nyt-komentorivilta#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="/kategoria/hifi/">Hifi</a></li>
	<li><a href="/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="/kategoria/rauta/">Rauta</a></li>
	<li><a href="/kategoria/viihde/">Viihde</a></li>
	<li><a href="/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/amarok/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">amarok</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize37" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize29" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/opiskelu/index.html" class="tagSizeMedium tagSize23" style="font-size: 100%;">opiskelu</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeLargest tagSize43" style="font-size: 100%;">palvelin</a></li>
	<li><a href="../../tag/pelaaminen/index.html" class="tagSizeMedium tagSize8" style="font-size: 100%;">pelaaminen</a></li>
	<li><a href="../../tag/rauta/index.html" class="tagSizeMedium tagSize29" style="font-size: 100%;">rauta</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize40" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">29. tammikuu 2011, 14:56</p>
<h1 class="entry-title"><a rel="bookmark" href="blogia-nyt-komentorivilta">Blogia nyt&#160;komentoriviltä</a></h1>


<div class="entry-content">
	<p>Noniin. Koska sain tuon lyhyiden mietteiden sovelman toimimaan melko hyvin, ajattelin nyt laajentaa tavalliset blogikirjoituksetkin tehtäväksi komentoriviltä, jossa olen melko luonnollisessa olotilassa.</p>

	<p>Ensimmäinen kokeilu tuotti ikävän yllätyksen, kun sain kaiken näennäisesti toimimaan, ja lopulta pieni typo python-koodissani sai ohjelman keskeytymään ennen kuin se lähetti datan (isohko blogikirjoitus) palvelimelle. Temppitiedosto tietenkin meni, joten se tieto hävisi komeasti. </p>

	<h2>Python</h2>

	<p>Tein parannuksia python-koodiin siitä, mitä se <code>tweet.py</code>-tiedostossa oli. Ja lisäsin pari varmistelua. Ja tein koodista enemmän python-henkistä. Mutta voi kamala, miten sotkuista se imperatiivinen purkkailu onkaan. Täytyy sanoa kuitenkin kaikki huomioonottaen, että Python on todella nättiä verrattuna siihen bash-koodiin, jota useimmiten tämäntyylisessä käytettäisiin. </p>

	<p>Ensin tein oikeaoppisen editorihaun ympäristömuuttujasta:</p>

<pre class="python">import os
EDITOR = os.environ[&#39;EDITOR&#39;]
</pre>

	<p>Ei ollut vaikeata. Seuraava vaihe on tehdä pieni pohjateksti käyttäjälle avuksi. Sekä käyttäjälle että parsivalle ohjelmalle avuksi. Demosin sitä jo pari postausta aikaisemmin: muoto on tämmöistä:</p>

<pre>Otsikko:
Tagit:
----- Viesti -----
</pre>

	<p>Ja sitten siihen loppuun kirjoitellaan iloisesti (kuten nyt) tarinaa. Idea on selvästi Emacsin mail modesta, mutta vastaavaa olen varmasti ajatellut ennen tietoa Emacsin moodiloista. Onhan tuo melko helppo ratkaisu, ja toimivakin, ellei käyttäjä mene sössimään noita esitäytettyjä tekstejä.</p>

	<p>Itse tiedostoa parsitaan Pythonin melko C-kielisellä rajapinnalla. Siirsin sen omaan funktioonsa, koska sitä piti käyttää useammassa kohdassa:</p>

<pre class="python">def parse_file(f):
  &quot;&quot;&quot; Given file handle f, read and parse according to the format.
  Return 3-tuple (title, message, tags). &quot;&quot;&quot;
  f.seek(0)
  # now just go through the file format
  title = f.readline().strip()
  tags = f.readline().strip()
  f.readline() # the separator
  message = f.read().strip()
  # some final handling
  title = re.sub(r&quot;\A.*?: ?&quot;, &quot;&quot;, title)
  tags = re.sub(r&quot;\A.*?: ?&quot;, &quot;&quot;, tags)
  return (title, message, tags)
</pre>

	<p>Sotkuista, ehkä. Tiedostokahva kelataan alkuun varmuuden varalta. Jo yksinään <code>readline</code>-metodin ansionsta alkeelliset formaatit, kuten nämä, on helppo koodata vapaasti. Tietysti jäykkähän tämä on kuin mikä. Parempi ratkaisu voisi olla jakaa kaikki rivit ennen separaattoria sanakirjoiksi, joissa avainsana määräytyy ensimmäisen sanan myötä. Avainsanaa vastaava sisältö tietenkin :-merkkiä seuraavalla tekstillä. Kuitenkin nyt on näin. Tyydyin käyttämään säännöllisiä lausekkeita laiskuuttani tässä. </p>

	<p>Seuraavaksi itse ydin, eli luodaan tilapäinen tiedosto Pythonin erinomaisen <em>tempfile</em> -kirjaston avulla. Sitten siihen tallennetaan alkuteksti ja kutsutaan editoria. Myöhemmin mukaan tuli pieniä kehityksiä:</p>

<pre class="python">with tempfile.NamedTemporaryFile(suffix=&quot;.textile&quot;) as tempfile:
  tempfile.write(initial_message)
  tempfile.flush()
  title = &quot;&quot; # ensures the loop below

  while len(title) &lt; 2 or len(message) &lt; 10:
    call([EDITOR, tempfile.name])
    (title, message, tags) = parse_file(tempfile)
</pre>

	<p>Määrään mielelläni temppitiedoston päätteeksi jotain järkevää, koska nyt voin Vimissä konfiguroida näyttämään tiedostot sopivalla värityksellä, ja vaikkapa apuplugineilla (joita ei kyllä näin alkeelliseen merkintäkieleen tarvitse). Myös SnipMate pelaa tiedostopäätteiden kanssa oletuksena, joten sekin vaihtoehto meille avautuu. Kuten arvata saattaa, <code>with</code> -rakenteella luotu TemporaryFile poistetaan automaattisesti lohkon loputtua. Silmukassa pyörimme tyydyttävästi vain sen verran, että käyttäjän tekemät selkeät virhetallennukset jäävät haaviin.</p>

	<p>Sivuhuomautuksena mainittakoon, että <code>call</code> tuossa kutsussa on modulista <code>subprocess</code>. Mainittua kutsua suositellaan käytettäväksi esimerkiksi <code>os.system()</code>-kutsun sijaan. Suosittelen käyttämään, toimii hyvin ja ilman ongelmia.</p>

	<p>Loppukoodi on samanlaista edellisen kanssa. Laitamme viestin menemään maailmalle, ja kohta nähdään, miten ensimmäinen isompi viesti (tämä) tulee läpi. Kokeilujen valossa pitäisi mennä kerralla.</p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/blogisäätöä/index.html" rel="tag">blogisäätöä</a>, 
<a href="../../tag/python/index.html" rel="tag">python</a>, 
<a href="../../tag/vim/index.html" rel="tag">vim</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../381/mikrobloggailua-talossa" title="Mikrobloggailua talossa">&#171; Mikrobloggailua talossa</a> 
           &mdash; <a rel="next" href="../417/vaihtele-arvoja-vimissa" title="Vaihtele arvoja Vimissä">Vaihtele arvoja Vimissä &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../598/blogille-idea">Blogille&#160;idea</a></span> &#183; <span class="published">2013-01-05</span>
<br /><span class="smallexcerpt">Uuden org-pohjaisen blogialustan miettiminen ja kehittäminen on vasta aluillaan, vaikka yhä uskon joustavamman alustan tarjoavan paremman kanavan tajunnanvirtani ohjaamiselle. Ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a></span> &#183; <span class="published">2012-11-30</span>
<br /><span class="smallexcerpt">O&#8217;Reillyn hienon blogiohjelman kautta ilmaiseksi saamani kirja kertoo tyydyttävästi kaikenlaista, mitä Matlabia ja R:ää kammoksuva haluaa tietää! Tässä tapailen mietteitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a></span> &#183; <span class="published">2012-10-23</span>
<br /><span class="smallexcerpt">Itä-Suomen yliopiston weboodissa alkaa olla aika usein kurssi-infot hyvässä kunnossa, ja nyt on myös joensuulaisille olemassa tuota lukkaria, joka on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a></span> &#183; <span class="published">2012-10-17</span>
<br /><span class="smallexcerpt">Tässä on ihmetelty jo hyvän aikaa uusissa maailmoissa, ja pitkälle on päästy. En olisi itsestäni uskonut, että Emacsissa ollaan jonain...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../592/emacs-has-me">Emacs has&#160;me.</a></span> &#183; <span class="published">2012-09-22</span>
<br /><span class="smallexcerpt">Emacs alkaa ottaa otetta minusta. Olen yrittänyt olla pyristelemättä vastaan, eikä ole asiaa vastaan mitään sanottavaa. Kaikki ne herkut ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a></span> &#183; <span class="published">2012-09-14</span>
<br /><span class="smallexcerpt">Kun päädyin pari viikkoa sitten Org-formaattiin, oli se luonnollisesti edellytys, että Vim ja sen VimOrganizer saadaan kuntoon. Nyt kuitenkin on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../590/think-vimorganizer">Think&#160;VimOrganizer.</a></span> &#183; <span class="published">2012-09-02</span>
<br /><span class="smallexcerpt">Asiat rullaavat eteenpäin tyydyttävää tahtia tämän uuden tiedonhallinnan kanssa. Nyt olen säätänyt kuntoon jokaisesta kulmasta toimivan org-capture -variantin, jolla saan...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../589/think-orgmode">Think&#160;orgmode.</a></span> &#183; <span class="published">2012-08-31</span>
<br /><span class="smallexcerpt">Teemme taas täyden ympyrän palatessamme orgmodeen, tuohon viha-rakkaussuhteen saaneeseen pakettiin. Edellinen thinktank-idea lopulta vääntyy siihen, että voin joko tehdä simppelin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../584/pythonin-vastaisku-lispeille-ipython-ja-vim-ipython">Pythonin vastaisku lispeille: IPython ja vim-ipython</a></span> &#183; <span class="published">2012-07-25</span>
<br /><span class="smallexcerpt">Tai &#8220;Pythonin uusi toivo&#8221; tai &#8220;Pythonin paluu&#8221;. Mistä on kyse? Pythonin tulkin me kaikki kai tiedämme: kaikki siinä periaatteessa on,...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

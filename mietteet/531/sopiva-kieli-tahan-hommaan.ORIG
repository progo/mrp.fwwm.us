<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Sopiva kieli tähän hommaan</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="sopiva-kieli-tahan-hommaan#content">Siirry sisältöön</a></li>
        <li><a href="sopiva-kieli-tahan-hommaan#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="http://progo.viuhka.fi/kategoria/hifi/">Hifi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/rauta/">Rauta</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/viihde/">Viihde</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize24" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize104" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize22" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize41" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/ostoksia/index.html" class="tagSizeMedium tagSize10" style="font-size: 100%;">ostoksia</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeMedium tagSize36" style="font-size: 100%;">palvelin</a></li>
	<li><a href="../../tag/pelaaminen/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">pelaaminen</a></li>
	<li><a href="../../tag/rauta/index.html" class="tagSizeMedium tagSize22" style="font-size: 100%;">rauta</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published"> 4. kesäkuu 2011, 12:34</p>
<h1 class="entry-title"><a rel="bookmark" href="sopiva-kieli-tahan-hommaan">Sopiva kieli tähän&#160;hommaan</a></h1>


<div class="entry-content">
	<p>Voi veljet. Annoin itselleni tehtäväksi parsia tekstimuotoista <span class="caps">TODO</span>-listaa koneen paremmin ymmärtämiksi riveiksi, joita on luontevaa antaa vaikka Conkylle pureksittavaksi. Formaattia luulin helpoksi käsiteltävän Pythonilla, mutta toisin kävi.</p>

	<h2>Formaatti</h2>

	<p>Tässä on ote Todo-listastani VimWiki-etusivulta.</p>

<pre>= TODO =

- [ ] Rtorrentista delugeen. Paljon etuja.
- [ ] Irssiin joku väritys nimimerkeille. Samanhenkinen systeemi kuin
    irssilog-syntaksivärjäyksessä vimissä.
- [ ] conkyyn viritelmä lukea tästä index.wiki -tiedostosta ruksaamattomia
    juttuja. Mitäpä ei perlinpätkällä saisi aikaan. Intervalliksi vaikka 5 min,
    jotta ei tunnu pahasti
- [ ] järjestele kaikki allaolevat aliotsakkeet omiksi sivuikseen
- [ ] Skeezulle shell-opas: vuoropuhelumalliin? Little Schemer.
</pre>

	<p>No, tässä ei ole vain ote, vaan koko listaus. Ajattelin jo, että tämä onnistuu helpolla iteraatiolla Pythonissa. Mutta ei oikein onnistu. Tiedostoa ensin voi lukea siihen pisteeseen, että löydetään rivi, jolla lukee <code>= TODO =</code>, ja sitten parsitaan seuraavan kappaleen edestä.</p>

	<p>Mutta moniriviset viritelmät lisäävät kovasti työtä, ja koodista tuli hyvin nopeasti epäelegantin näköistä. Fiksuinta olisi ollut kai tässä tapauksessa kirjoittaa rekursio, mutta kyllästyin siihen nopeasti. Vimissä asioita pyöriteltyäni tajusin, että vim-skripti voisi ollakin oikea ratkaisu tähän malliin. Vimiähän on helppo skriptata myös tekstitiedostoa käyttäen, mutta ongelmana oli, että sitä ei saa tulostettua stdouttiin. </p>

	<p>Ratkaisuna on <code>ex</code>, tuo surullisenkuuluisan <code>ed</code>-ohjelman helpompi seuraaja, jota myös <code>vi</code>-ohjelman taustalla käytetään. Ex-skriptissä en voi käyttää kaikkia herkullisia vim-komentoja, mutta tulos on silti aika mukiinmenevä. Ex-kieli sopii tämänlaiseen tekstinkäsittelyyn hävyttömän hyvin. Ei tarvitse ajatella niinkään silmukoita tai rekursioita, vaan ajatellaan, että nyt etsitään tämä kohta ja tehdään siihen nämä muutokset. Tässä on lopullinen koodi, ns. ex-skripti:</p>

<pre>edit /home/progo/.vim/wiki/index.wiki

&quot; Poistetaan kaikki TODO-riviin asti
1,/^= TODO =/d

&quot; sekä yksi (toiv.) tyhjä rivi
1d

&quot; Sitten poistetaan kaikki TODO-kappaleen jälkeinen, alkaen ensimmäisestä tyhjästä 
/^\s*$/;$d

&quot; sitten yhdistetään moniriviset virsut
%g/^    /exe &quot;normal kJ&quot;

&quot; ja poistetaan tehdyt pois, ja siistitään.
%g/- \[X] /d
%s/- \[ ] //
%p
q!
</pre>

	<p>Rankasti kommentoitu, jotta ei mene sekaisin. Onhan tuo nimittäin aika kryptistä. Pääideana ex-komennoissa on antaa lähtöosoite, loppuosoite, sekä joku toiminto (delete, move, copy). Tavallisesti osoitteet tarkoittavat rivinumeroita, mutta onneksi ex tukee myös hakutoimintoa osoitteen tilalla.</p>

	<p>Kun yhdistelemme monirivisiä todo-entryjä, joudumme käyttämään Vim-spesifisiä erikoiskikkoja: nimittäin Vimissä voimme käyttää <code>g</code>-komennon (global) kanssa vim-komentoja tai -funktioita. Aina löytäessämme sisennetyn rivin, komennamme vim-komentoa <code>kJ</code> sille riville. Koo niin kuin ylöspäin yksi rivi, ja iso J on alemman rivin joinaaminen ylempään. Turhat välit hävitetään automaattisesti. Tämä olisi pythonilla vaatinut aikamoista iteraatiomagiaa, tai ainakin vakavaa regexp-taituruutta. Väittäisin, että vim-harrastaja näkee tämän ex-skriptin ainakin hieman helppolukuisempana.</p>

	<p>Ikävä yllätys oli se, että ex-skriptiä suoritettaessa se tallensi tiedostoon tehdyt muutokset, vaikka en erikseen skriptiin antanut tuttua <code>:write</code>-komentoa. Erillinen <code>quit!</code> näyttää kuitenkin auttavan. Onnistuin jo menettämään joitain tekemiäni muutoksia wikin etusivuun. Backup on parin päivän takaa, ja onneksi kaikkea ei menetetty.</p>

	<p>Olen kuitenkin haltioissani saadessani lisätä exin työkalupakkiini. Tässä tuntee itsensä järin tehokkaaksi.</p>
</div>

<p class="tags"> 


Tageja: <a href="http://progo.viuhka.fi/tag/ex/" rel="tag">ex</a>, 
<a href="../../tag/ohjelmointi/index.html" rel="tag">ohjelmointi</a>, 
<a href="../../tag/vim/index.html" rel="tag">vim</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../530/levyt-ja-miten-niihin-paasee-sisaan" title="Levyt, ja miten niihin pääsee sisään">&#171; Levyt, ja miten niihin pääsee sisään</a> 
           &mdash; <a rel="next" href="../532/makefile-pohja-rst-projektille" title="Makefile-pohja rst-projektille">Makefile-pohja rst-projektille &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a></span> &#183; <span class="published">2012-10-23</span>
<br /><span class="smallexcerpt">Itä-Suomen yliopiston weboodissa alkaa olla aika usein kurssi-infot hyvässä kunnossa, ja nyt on myös joensuulaisille olemassa tuota lukkaria, joka on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a></span> &#183; <span class="published">2012-10-17</span>
<br /><span class="smallexcerpt">Tässä on ihmetelty jo hyvän aikaa uusissa maailmoissa, ja pitkälle on päästy. En olisi itsestäni uskonut, että Emacsissa ollaan jonain...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../592/emacs-has-me">Emacs has&#160;me.</a></span> &#183; <span class="published">2012-09-22</span>
<br /><span class="smallexcerpt">Emacs alkaa ottaa otetta minusta. Olen yrittänyt olla pyristelemättä vastaan, eikä ole asiaa vastaan mitään sanottavaa. Kaikki ne herkut ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a></span> &#183; <span class="published">2012-09-14</span>
<br /><span class="smallexcerpt">Kun päädyin pari viikkoa sitten Org-formaattiin, oli se luonnollisesti edellytys, että Vim ja sen VimOrganizer saadaan kuntoon. Nyt kuitenkin on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../590/think-vimorganizer">Think&#160;VimOrganizer.</a></span> &#183; <span class="published">2012-09-02</span>
<br /><span class="smallexcerpt">Asiat rullaavat eteenpäin tyydyttävää tahtia tämän uuden tiedonhallinnan kanssa. Nyt olen säätänyt kuntoon jokaisesta kulmasta toimivan org-capture -variantin, jolla saan...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../589/think-orgmode">Think&#160;orgmode.</a></span> &#183; <span class="published">2012-08-31</span>
<br /><span class="smallexcerpt">Teemme taas täyden ympyrän palatessamme orgmodeen, tuohon viha-rakkaussuhteen saaneeseen pakettiin. Edellinen thinktank-idea lopulta vääntyy siihen, että voin joko tehdä simppelin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../584/pythonin-vastaisku-lispeille-ipython-ja-vim-ipython">Pythonin vastaisku lispeille: IPython ja vim-ipython</a></span> &#183; <span class="published">2012-07-25</span>
<br /><span class="smallexcerpt">Tai &#8220;Pythonin uusi toivo&#8221; tai &#8220;Pythonin paluu&#8221;. Mistä on kyse? Pythonin tulkin me kaikki kai tiedämme: kaikki siinä periaatteessa on,...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../581/sumitup-puutteet-ja-mihin-suuntaan-edetaan">SumItUp: puutteet ja mihin suuntaan&#160;edetään</a></span> &#183; <span class="published">2012-07-12</span>
<br /><span class="smallexcerpt">Esittelin pari postausta sitten Soulver-kloonin raakileen, SumItUpin. Nyt se on GitHubissa kaikkien pällisteltävänä ja sellaisella raakileasteella, jotta sitä voi jo...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../579/soulver-kloonia-rakentelemassa">Soulver-kloonia&#160;rakentelemassa</a></span> &#183; <span class="published">2012-07-07</span>
<br /><span class="smallexcerpt">Erittäin upealla konseptilla varustettu laskinohjelma Soulver kaatuu siihen, että sen saa vain Mäkille. Vapaamuotoinen näpertelyalusta on usein ainut asia, mitä...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: WebOodi-aikataulut orgiin</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="weboodi-aikataulut-orgiin#content">Siirry sisältöön</a></li>
        <li><a href="weboodi-aikataulut-orgiin#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/598/blogille-idea.html">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly.html">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/596/org-blogaaminen-vaikeata.html">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/595/twitterointia-emacsilla.html">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    &rsaquo;
                    <a rel="bookmark" href="/mietteet/594/weboodi-aikataulut-orgiin.html">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita.html">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/592/emacs-has-me.html">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/591/editorien-taistelu-tietamyshallinnassa.html">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/590/think-vimorganizer.html">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/589/think-orgmode.html">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="/kategoria/hifi/">Hifi</a></li>
	<li><a href="/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="/kategoria/rauta/">Rauta</a></li>
	<li><a href="/kategoria/viihde/">Viihde</a></li>
	<li><a href="/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize25" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize105" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize31" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize23" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize42" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/opiskelu/index.html" class="tagSizeMedium tagSize17" style="font-size: 100%;">opiskelu</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeMedium tagSize37" style="font-size: 100%;">palvelin</a></li>
	<li><a href="../../tag/python/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">python</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">23. lokakuu 2012, 19:54</p>
<h1 class="entry-title"><a rel="bookmark" href="weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a></h1>


<div class="entry-content">
	<p>Itä-Suomen yliopiston weboodissa alkaa olla aika usein kurssi-infot hyvässä kunnossa, ja nyt on myös joensuulaisille olemassa tuota lukkaria, joka on hyvä ratkaisu. No, olisi, jos matematiikat saisi kanssa listoille. Ja valintani on muutenkin org-mode, joten sen kanssa on mentävä. Vaihteeksi uutta Python-koodinpätkää: oodista kopypastettuja aikatauluja org-aikaleimoiksi.</p>

	<p>Syöte on tämänlaista:</p>

<pre>29.10.-17.12.12
    ma 16.00-18.00 
31.10.-19.12.12
    ke 08.00-10.00 
01.11.12
    to 08.00-10.00 
09.11.12
    pe 10.00-12.00 
</pre>

	<p>Eli joko on yksittäisiä aikoja tai on isompia välejä, joiden ajat toistuvat viikottain. Org-mode ottaa vastaan kuitenkin vain tämänlaisia aikaleimoja:</p>

<pre>&lt;2012-10-15 Mon 16:00-18:00&gt;
&lt;2012-10-29 Mon 16:00-18:00 +1w&gt;
</pre>

	<p>Eli yksittäisiä päiviä, joilla on mahdollisesti kellonaika. Org osaa tehdä noita toistuvia aikoja (jälkimmäisessä <code>+1w</code> viittaa viikottaiseen tapahtumaan).</p>

	<h2>Pythonin kanssa taistoon</h2>

	<p>Ensin puntaroin tekeväni tämän Elispillä, koska kuitenkin org-ympäristö on ainut, jossa tätä tarvitsee. Ajattelin, että elispin aika ja paikka on joskus myöhemmin. Arkkitehtuuri sovellukselleni on tyypillinen:</p>

	<ul>
		<li>lue tiedostosta tai standardi-inputista rivit ylös</li>
		<li>(lukee tosin kaiken kerralla koska laiskat tietorakenteet eivät pythonissa loista)</li>
		<li>rivit annetaan delegointifunktiolle, joka päättää, onko rivipari aikajakso vai yksittäinen päivä:
	<ul>
		<li>jos jakso, niin pura pythonin päivämäärätyökaluilla jakso joukoksi yksittäisiä päiviä, ja passaa seuraavalle:</li>
		<li>jos päivä, niin käännä se erinäisten kikkastelujen jälkeen org-aikaleimaksi.</li>
	</ul></li>
	</ul>

	<p>Joitain otteita koodista voisi kaiketi antaa. Sisään mennään tämännäköisellä hirvityksellä. Pythonin <code>fileinput</code> on loistava, vaikka se vaatiikin kaksi <code>C-d</code>:tä lopettaakseen.</p>

<pre class="python">if __name__ == &#39;__main__&#39;:
    import fileinput
    inputd = [line.strip() for line in fileinput.input() if line.strip() != &#39;&#39;]
    finished = [do_line(date, time)
                for date, time
                in zip(inputd[::2], inputd[1::2])]
    print &#39;\n&#39;.join(finished)
</pre>

	<p>Funktio <code>do_line</code> toimii delegoijana. Mennäänpä nyt päivämääriin. Tämä funktio <code>do_date</code> hoitaa yksittäistapauksen. Toinen apufunktio, <code>toDate</code>, on ollut jo käytössä delegaatissa (ankkatyyliin jos saadaan parsintapoikkeus niin tulkitaan teksti intervalliksi), joten <code>do_date</code> saa datan puoliksi python-olioina ja toinen puoli on tekstiä.</p>

<pre class="python">def toDate(string):
    &quot;&quot;&quot; %d.%m.%y -&gt; DateTime. &quot;&quot;&quot;
    return datetime.datetime.strptime(string, &quot;%d.%m.%y&quot;)
def do_date(date, time):
    &quot;&quot;&quot; convert one date, time pair to org &quot;&quot;&quot;
    return &quot;&lt;&quot; + date.strftime(&quot;%Y-%m-%d&quot;) + &quot; &quot; + runtime(time) + &quot;&gt;&quot;
</pre>

	<p>Tekstipuoli käännetään <code>runtime</code>-funktiolla, joka on vain merkkijonokäpistelyä. Viikonpäivät suomesta englantiin ja semmoista. Intervalli oli hieman kiinnostavampi. Sen saa palautettua yksittäisiksi päivämääriksi verraten helposti <code>datetime.timedelta</code> -luokan voimin:</p>

<pre class="python">def do_intervalled_line(interval, time):
    &quot;&quot;&quot; interval is of form &quot;%d.%m.-%d.%m.%y&quot;. &quot;&quot;&quot;
    begin, end = interval.split(&#39;-&#39;)
    # &#39;begin&#39; may get the same year as end... I smell trouble
    begin = begin + end.split(&#39;.&#39;)[-1]
    begin = toDate(begin)
    end = toDate(end)
    acc = []
    week = datetime.timedelta(days=7)
    while begin &lt;= end:
        acc.append(do_date(begin, time))
        begin = begin + week
    return acc
</pre>

	<p>Ilmassa on pientä hakkailua, joka tuskin kestää lähempää tarkastelua. Homma lähti kuitenkin ensipolkaisulla käyntiin, joka on aina iloinen yllätys.</p>

	<h3>Jatkokehittelyä</h3>

	<p>Tässä yhden hengen katselmoinnissa tosin huomasin, että listoja pitää vielä vähän tasata: testisyötteeni oli kaikki intervalleja ja saattaa paukkua, jos syötteessä on seassa yksittäisiä päiviä. Tai ainakin siltä vähän näyttäisi.</p>

	<h1>Koodi käyttöön</h1>

	<p>Vimissä on tyylikäs <code>!</code>-komento, jolle voi &#8216;putkittaa&#8217; tekstivalinnan, ja putken päästä tuleva tavara korvaa valinnan. Esimerkiksi <code>!sort</code> tekee valinnalle sitä, miltä kuulostaakin. Emacsin vastaavaa en heti hoksannutkaan, mutta onneksi Evil hoiti homman kotiin. Googlailujen jälkeen selvisi, että Emacsin oma tapa on <code>C-u M-|</code>. Saapa olla jatkossakin.</p>

	<p>Emacsista toimintakuva (kun kirjoitan tätä blogiviestintapaista):</p>

	<p><img src="http://havu.viuhka.fi/kuvat/emacs_vaerit.png" alt="" /></p>

	<p>Hassusti se tuo muotoilut kopioidessaan. Kiva sinänsä blogia tehtaillessaan, mutta jossain vaiheessa tuon on hajottava johonkin. Onhan?</p>

	<p>Seuraavalla kerralla voisin kirjoittaa org-agendan ja conkyn yhteensulautumista, jolla korvasin Rainlendarin kokonaan. Koodi ei siellä ole niin nättiä, että&#8230;</p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/emacs/index.html" rel="tag">emacs</a>, 
<a href="../../tag/python/index.html" rel="tag">python</a>, 
<a href="../../tag/vim/index.html" rel="tag">vim</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita" title="Emacsin salat alkavat selvitä; org kovenee ja muita tarinoita">&#171; Emacsin salat alkavat selvitä; org kovenee ja muita tarinoita</a> 
           &mdash; <a rel="next" href="../595/twitterointia-emacsilla" title="Twitteröintiä Emacsilla">Twitteröintiä Emacsilla &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../598/blogille-idea">Blogille&#160;idea</a></span> &#183; <span class="published">2013-01-05</span>
<br /><span class="smallexcerpt">Uuden org-pohjaisen blogialustan miettiminen ja kehittäminen on vasta aluillaan, vaikka yhä uskon joustavamman alustan tarjoavan paremman kanavan tajunnanvirtani ohjaamiselle. Ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a></span> &#183; <span class="published">2012-11-30</span>
<br /><span class="smallexcerpt">O&#8217;Reillyn hienon blogiohjelman kautta ilmaiseksi saamani kirja kertoo tyydyttävästi kaikenlaista, mitä Matlabia ja R:ää kammoksuva haluaa tietää! Tässä tapailen mietteitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a></span> &#183; <span class="published">2012-11-11</span>
<br /><span class="smallexcerpt">Haluaisin kovasti hylätä periaatteessa lukitut blogialustat puhtaan tekstin edessä, ja erityisesti ottaa org-mode kovaan käyttöön. Mutta kaikenlaisia pieniä probleemia on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a></span> &#183; <span class="published">2012-10-24</span>
<br /><span class="smallexcerpt">Tänään piti viettää kiva päivä käymällä hyvällä luennolla ja sitten pakertaa vähän tehtävien kimpussa koululla. Toisin kävi, kun tehtäviä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a></span> &#183; <span class="published">2012-10-17</span>
<br /><span class="smallexcerpt">Tässä on ihmetelty jo hyvän aikaa uusissa maailmoissa, ja pitkälle on päästy. En olisi itsestäni uskonut, että Emacsissa ollaan jonain...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../592/emacs-has-me">Emacs has&#160;me.</a></span> &#183; <span class="published">2012-09-22</span>
<br /><span class="smallexcerpt">Emacs alkaa ottaa otetta minusta. Olen yrittänyt olla pyristelemättä vastaan, eikä ole asiaa vastaan mitään sanottavaa. Kaikki ne herkut ja...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a></span> &#183; <span class="published">2012-09-14</span>
<br /><span class="smallexcerpt">Kun päädyin pari viikkoa sitten Org-formaattiin, oli se luonnollisesti edellytys, että Vim ja sen VimOrganizer saadaan kuntoon. Nyt kuitenkin on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../590/think-vimorganizer">Think&#160;VimOrganizer.</a></span> &#183; <span class="published">2012-09-02</span>
<br /><span class="smallexcerpt">Asiat rullaavat eteenpäin tyydyttävää tahtia tämän uuden tiedonhallinnan kanssa. Nyt olen säätänyt kuntoon jokaisesta kulmasta toimivan org-capture -variantin, jolla saan...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../589/think-orgmode">Think&#160;orgmode.</a></span> &#183; <span class="published">2012-08-31</span>
<br /><span class="smallexcerpt">Teemme taas täyden ympyrän palatessamme orgmodeen, tuohon viha-rakkaussuhteen saaneeseen pakettiin. Edellinen thinktank-idea lopulta vääntyy siihen, että voin joko tehdä simppelin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

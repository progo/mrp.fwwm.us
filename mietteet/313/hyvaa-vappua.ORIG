<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Hyvää vappua.</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="hyvaa-vappua#content">Siirry sisältöön</a></li>
        <li><a href="hyvaa-vappua#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="http://progo.viuhka.fi/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="http://progo.viuhka.fi/kategoria/hifi/">Hifi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/rauta/">Rauta</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/viihde/">Viihde</a></li>
	<li><a href="http://progo.viuhka.fi/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize25" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize105" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize23" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize42" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeMedium tagSize37" style="font-size: 100%;">palvelin</a></li>
	<li><a href="../../tag/rauta/index.html" class="tagSizeMedium tagSize23" style="font-size: 100%;">rauta</a></li>
	<li><a href="../../tag/skriptaus/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">skriptaus</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize34" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">30. huhtikuu 2010, 19:36</p>
<h1 class="entry-title"><a rel="bookmark" href="hyvaa-vappua">Hyvää&#160;vappua.</a></h1>


<div class="entry-content">
	<p>Innostuinpa kirjailemaan blogini viimeisenkin (hah) epäkohdan, nimittäin kevyen LaTeX-tuen. Nyt TextPattern hallitsee kauniin matematiikan ladonnan artikulaatin taidon.</p>

	<p>Homman suurin ongelma on varsin epäselvä koodirunko, jonka sisään homma piti saada ujuteltua. En ole laisinkaan varma, onko se täysin toimiva, taikka turvallinenkaan. Kuitenkin homma näyttää pelaavan: <img class="tex" src="http://l.wordpress.com/latex.php?latex=%5Cint_x%5E%7Bx%5E2%7D%20t%5E2%20%7B%5Crm%20d%7Dt&s=1&fg=FFFFFF&bg=000000" alt="\int_x^{x^2} t^2 {\rm d}t" />. Oikein mainio homma indeed; yllätin itsenikin taitojeni puitteissa, sillä TextPatternin ytimessä toimiva Textile-moottori on varsin kehnonlaista, joskin tyypillistä <span class="caps">PHP</span>-koodia. Onneksi se toimii sulavasti yksinäänkin, joten otin sen lokaaliin käsittelyyn ja interaktiivisen php-shellin avulla pääsin testailemaan eri osia. </p>

	<p><a href="http://forum.textpattern.com/viewtopic.php?pid=228206#p228206">Kirjailin suurimman osan</a> asiaankuuluville foorumeille, mutta ydinpalat voi täälläkin esitellä, ettei turhaan pirstaloidu koodikenttä.</p>

	<p>Funktio <em>graf</em> ilmeisesti käsittelee kunkin anonyymin lohkon (usein tekstikappale, ei siis koodi- tai sitaattilohko) osioita, ja itsessään funktio kutsuu vain litaniaa muita funktioita, jotka kukin hoitavat pienen osan parserointia. Ei kaikkein selkein ratkaisu, mutta näyttää toimivan, eikä muutos yhteen paikkaan taida rikkoa muita osioita kovin pahasti. Apuna on kiva funktio <code>doSpecial</code>, joka suorittaa käyttäjän puolesta likaista regular expression -työtä, ja sitten löydetyillä tuloksilla kutsuu käyttäjän antamaa funktiota. Näin homma onkin järkevintä tehdä. Annetaan helppo frameworkki, johon on suorastaan luontevaa työntää omaa koodia. Tämä kutsu on graf-funktion sisään tyrkättynä:</p>

<pre class="php">$text = $this-&gt;doSpecial($text, &#39;$$&#39;, &#39;$$&#39;, &#39;fLatex&#39;);
</pre>

	<p>Ja kun se kutsuu <em>fLatex</em>-funktiota parametrinaan $ $-merkkien sisään jäävällä datalla, homma on selkeä. Käytännössähän meidän ei tarvitse tehdä muuta kuin kääriä annettu koodi urliyhteensopivaksi, ja kirjoittaa uusi <code>img</code>-tagi:</p>

<pre class="php">/* Parse LaTeX  strings into pictures */
function fLatex($m) 
{
    @list (, $before, $text, $after) = $m;

    $uri = &quot;http://l.wordpress.com/latex.php&quot;;
    $background = &quot;000000&quot;; // colours for pictures
    $foreground = &quot;FFFFFF&quot;; 
    $size = &quot;1&quot;;
    $style = &quot;tex&quot;;

    return &quot; &lt;img class=\&quot;$style\&quot; src=\&quot;&quot;. $uri . &#39;?latex=&#39;
        . rawurlencode($text) . &quot;&amp;s=$size&amp;fg=$foreground&amp;bg=$background\&quot;&quot;
        . &quot; alt=\&quot;$text\&quot;&quot;
        . &quot; /&gt;&quot;;
}
</pre>

	<p>Ja periaatteessa mikä hyvänsä LaTeXia <span class="caps">GET</span>-parametrinaan vastaanottava kuvageneroija (vaikkapa wikipedian oma, jos ei muuta keksi) kelpaa tähän hommaan hienosti. Olen säädellyt yo. koodissa asetuksiksi tälle blogille sopivat arvot. Valkoista tummalle. </p>

	<p>Tokihan koodi on vähän rumaa, ei testattua ja hidastakin (välimuistiratkaisun voisi hyvinkin kirjoitella vielä tähän, mutta toisaalta <span class="caps">PHP</span> turvamoodissaan toimiessa ei tykkää tiedostojen latailusta ja tallentelusta), mutta minusta se on toimiva ja tarpeisiin nähden varsin riittävää. </p>

	<p>Parannusehdotuksia saa tietysti ehdotella. Luultavasti saan moitetta tai kiitosta myös tuolta tukifoorumilta, mutta katsotaan nyt. </p>

	<p>Ja miksikö tämä vaiva? Aloitin uuden osion blogissani, jossa pyrin kuvailemaan kehittymistäni matemaatikkona ja sen opiskelijana. Toivottavasti se saa tulta alleen, vaikka se nyt jääkin miltei välittömästi tauolle. </p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/latex/index.html" rel="tag">latex</a>, 
<a href="../../tag/skriptaus/index.html" rel="tag">skriptaus</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../311/ensimmainen-taistelu-havittiin" title="Ensimmäinen taistelu hävittiin">&#171; Ensimmäinen taistelu hävittiin</a> 
           &mdash; <a rel="next" href="../318/from-bash-to-z-shell" title="From Bash to Z Shell">From Bash to Z Shell &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../342/latex-viittaukset-vimissa">LaTeX-viittaukset&#160;Vimissä</a></span> &#183; <span class="published">2010-10-09</span>
<br /><span class="smallexcerpt">Kirjailin taas uuden palan korostamaan, miten hienosti saa Vimistä irti kaikenlaista. LaTeXissa ja TeXissä yleensäkin viittailessa omaan dokumenttiin halutaan yleensä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../../matematiikka/312/osion-avaus">Osion&#160;avaus</a></span> &#183; <span class="published">2010-04-30</span>
<br /><span class="smallexcerpt">Tämmöinen pieni idea syntyi siitä, kun tässä parin kuukauden mittaan olen voivotellut sitä seikkaa, että netistä ei tunnu millään löytyvän...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../7/tehokkuutta-tyoepoeytaekaeyttoeoen">Tehokkuutta&#160;työpöytäkäyttöön</a></span> &#183; <span class="published">2010-02-07</span>
<br /><span class="smallexcerpt">Noniin, on aika viihdyttää taas teitä rakkaita kuuntelijoitani muutamalla pohdinnalla ja jäkätyksellä tehokkuudesta.
Ensiksikin voisin puhua pitkään mieltäni kourineesta jutusta. Jos...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../8/vim-skriptaus-on-helppoa-ja-mukavaa">Vim-skriptaus on helppoa ja&#160;mukavaa</a></span> &#183; <span class="published">2010-01-31</span>
<br /><span class="smallexcerpt">Vim on erityisen hieno editori, ja mikä siitä tekee jokseenkin erityisen hienon, on se seikka, että sitä on hyvin helppo...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../9/naeytoet-ja-vim">Näytöt ja&#160;Vim</a></span> &#183; <span class="published">2010-01-25</span>
<br /><span class="smallexcerpt">Unohdin tässä mainita, kuinka lauantainen operaationi sujui. Lisäksi lisää rakkaudenosoituksia Vimiä kohtaan. Ja lopuksi käydään läpi paranneltu MPD-skriptini, joka esiteltiin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../16/vim-webbikirjoituksessa">Vim&#160;webbikirjoituksessa</a></span> &#183; <span class="published">2009-12-03</span>
<br /><span class="smallexcerpt">Yksi pieni vinkki esimerkiksi sivun rakenteita tai tyylisivuja pähkäilevälle:
:au BufWritePost &lt;buffer&gt; silent !opera -activetab % &gt; /dev/null
Mitäpä tästä oikein nähdään?...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../21/simultaanikaeaentelyae">Simultaanikääntelyä</a></span> &#183; <span class="published">2009-11-07</span>
<br /><span class="smallexcerpt">Olen tässä nyt kaksi viikkoa käynyt kurssia Hajautetut ja samanaikaiset järjestelmät. Aiheena on siis ensisijaisesti järjestelmien hajautus mutta myös samanaikaista...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../38/matematikkaa-latexhousuissa">Matematikkaa&#160;latexhousuissa</a></span> &#183; <span class="published">2009-08-02</span>
<br /><span class="smallexcerpt">Xkcd-henkinen testi:

	 

	Olen kehitellyt pientä kiintymystä -notaatioon sen matemaattisten ansioiden takia. Muistaakseni pari kuukautta sitten turisin siitä blogiini, mutta nyt...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../46/kaeytettaevyydestae">Käytettävyydestä</a></span> &#183; <span class="published">2009-06-11</span>
<br /><span class="smallexcerpt">Olen näinä päivinä lukenut paljon Vimistä. Tämä Bram Moolenaarin ihmeteos on kyllä jotain ihanaa. Olenhan toki kertonut siitä aiemminkin, nyt...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../53/uutta-luettavaa">Uutta&#160;luettavaa</a></span> &#183; <span class="published">2009-05-19</span>
<br /><span class="smallexcerpt">
A.k.a: Amazon on petollinen ja lompakonsyöjä. Tällä kertaa selvisin helpolla, koska tuloja ei ole. Pakko oli kuitenkin jotain pientä ostaa....</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

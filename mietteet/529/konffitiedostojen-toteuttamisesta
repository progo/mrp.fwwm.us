<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Konffitiedostojen toteuttamisesta</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="konffitiedostojen-toteuttamisesta#content">Siirry sisältöön</a></li>
        <li><a href="konffitiedostojen-toteuttamisesta#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="/kategoria/hifi/">Hifi</a></li>
	<li><a href="/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="/kategoria/rauta/">Rauta</a></li>
	<li><a href="/kategoria/viihde/">Viihde</a></li>
	<li><a href="/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize102" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize28" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize20" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/ohjelmistot/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">ohjelmistot</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize39" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/opiskelu/index.html" class="tagSizeMedium tagSize14" style="font-size: 100%;">opiskelu</a></li>
	<li><a href="../../tag/rauta/index.html" class="tagSizeMedium tagSize20" style="font-size: 100%;">rauta</a></li>
	<li><a href="../../tag/vim/index.html" class="tagSizeMedium tagSize31" style="font-size: 100%;">vim</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">28. toukokuu 2011, 18:58</p>
<h1 class="entry-title"><a rel="bookmark" href="konffitiedostojen-toteuttamisesta">Konffitiedostojen&#160;toteuttamisesta</a></h1>


<div class="entry-content">
	<p>Erilaisia <code>rc</code>-tiedostoja (runtime configuration) on vaikka pilvin pimein, ja syitä tähän on monia. Yksi on erilaiset vaatimukset hyvältä konffilta, ja toisaalta toinen on että alkeelliset konffilukijat syntyvät jo parilla rivillä. Kehittyneintä puolta edustaa Xmonadin ja <span class="caps">DWM</span>:n suunnittelumalli &#8220;konffista-käännetään-ajettavat&#8221;. Toimii, jos käytät kehittynyttä ja sofistikoitunutta kieltä (<span class="caps">DWM</span>, epäonnistuit juuri). </p>

	<h1>Alkeellisimpia lukijoita C++:lla</h1>

	<p>Kirjoitin erästä soittolistaohjelmaa varten hyvin alkeellisen lukijan. Hyviä puolia ovat esimerkiksi kovakoodattujen vakioiden puute. Harmikseni en vain koskaan saanut loppua ohjelmaa niin valmiiksi, että konffilla olisi ollut kovasti käyttöä. Koitanpa etsiä sen tähän:</p>

<pre class="cpp">string temp;
std::ifstream config (file.c_str());
if(config.is_open()) {
    // check out config line by line
    while(config.peek() != EOF) {
        std::getline(config, temp);
        TrimSpaces(temp);
        if(temp[0] == &#39;#&#39;)  // we could add some extra comment markers here
            continue; // to the next line

        // fetch the position of &#39;=&#39;
        size_t loc = temp.find_first_of(&#39;=&#39;);
        if(loc == string::npos)
            continue;	// some issues here

        string name, value; // the parts of the config setting line
        name = temp.substr(0, loc);
        value = temp.substr(loc+1);

        // insert the succesful pair into the config map:
        this-&gt;config.insert(std::pair&lt;string, string&gt;(name, value));
    }
    config.close();
}
</pre>

	<p>No, koodini on kirjoitettu aika kauan aikaa sitten. Nyttemmin asian voisi hoitaa hyvinkin elegantisti. Idea on kuitenkin hyvä: yksinkertaisesti työnnetään koko konffin avain-asetusparit kuvaukseen, josta ne on sitten helppo kaivaa esille. Lukuasetuksia varten pitäisi koodata vähän lisää abstraktiota, mutta noin muuten. Se toimi täydellisesti niihin toimiin, joihin sitä itse tarvitsin (lähinnä tallentamaan käyttäjätunnuksen ja salasanan verkkoyhteyttä varten).</p>

	<h1>Fiksummat konffitiedostot</h1>

	<p>Edelläkuvattu malli on tavallaan kytköksissä kaikkiin alkeellisia avain-asetus -pareja sisältäviin asetustiedostoihin. Tavallisesti enempää ei tarvitse ollakaan. Toki listoja ja kuvauksia sisältävät <span class="caps">JSON</span>-muotoiset konffit ovat askel eteenpäin nykyisestä, mutta periaatteessa sitä samaa kauraa.</p>

	<p>Erikoistuneita <acronym title="Domain Specific Language"><span class="caps">DSL</span></acronym> -kieliä seuraa Turing-täydelliset kielet. Eric S. Raymondin mukaan joskus kannattaa huolehtia, että konffikieli ei ole Turing-täydellinen, ja joskus kannattaa varmistaa, että se on. </p>

	<p>Jos mennään turing-täydellisiin kieliin, niin on mukavaa käyttää olemassaolevia kieliä, joille on kieliä ja muuta. Yleisimmät kielet tähän hommaan ovat Lua ja Scheme. Kumpikin rajusti kustomoitavissa, sekä kevyitä, ja helposti integroitavissa isompaan ohjelmaan. Tänään StackOverflow-kysymyksen innoittamana tutkin JScheme-nimistä Scheme-toteutusta Javalle.</p>

	<p>Schemen minimalistisuus kannustaa konffien luomiseen. JScheme on nopea pirulainen, ja tukee kaikkea Schemen hyvää, kuten <span class="caps">TCO</span>:takin. Mitä se ei tue, esimerkiksi isoja lukuja, joten se on vähän kamala siinä suhteessa. JSchemellinen java-ohjelma käynnistyy rajun nopeasti. Pitäisi kirjoitella vastaava perusviritelmä Clojurelle, jotta voi verrata. Nykyisiä ratkaisuja voi <a href="http://stackoverflow.com/questions/6160722/using-lisp-for-runtime-configuration-of-java-programs/6161021#6161021">lukea täältä</a>.</p>

	<p>Totta puhuen, JScheme jätti vähän pahan maun suuhun. Kaikki pitää hakea javan puolelle manuaalisesti. Toki ratkaisu löytyy tavalla tai toisella: saada kaikki kuvauksessa on minusta se ideaalisin ratkaisu. Kuitenkin Clojure pitää kääntää ensin, ja se on hidasta. Ja muutenkin Clojure on suunniteltu staattisia komponentteja varten, ei tulkattavia käynnistysskriptejä varten: missään ei ole kunnon ohjeita tai puheita tästä. Kaikki Clojure-Java -yhteenkäymiseen liittyvä keskustelu on pitkälti keskustelua Clojure-koodin kääntämisestä java-luokiksi. Tätä tuskin käyttäjämme haluaa joka muutoksen jälkeen tehdä. Ja varamsti sen käännöksen voi tehdä javassakin. Hidasta kuitenkin.</p>

	<p>Eli päädymme puolivälitauolle: toivottavasti tiedostamme staattisen konffitiedoston heikkoudet, ja ymmärrämme Turing-täydellisen kielen hyödyt. Mutta sitten teknisesti emme ole saaneet vielä toimivaa systeemiä parsittua kasaan.</p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/c++/index.html" rel="tag">c++</a>, 
<a href="../../tag/clojure/index.html" rel="tag">clojure</a>, 
<a href="../../tag/haskell/index.html" rel="tag">haskell</a>, 
<a href="../../tag/lisp/index.html" rel="tag">lisp</a>, 
<a href="../../tag/ohjelmointi/index.html" rel="tag">ohjelmointi</a>, 
<a href="../../tag/xmonad/index.html" rel="tag">xmonad</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../527/pdf-lukija-vaihtui" title="PDF-lukija vaihtui">&#171; PDF-lukija vaihtui</a> 
           &mdash; <a rel="next" href="../530/levyt-ja-miten-niihin-paasee-sisaan" title="Levyt, ja miten niihin pääsee sisään">Levyt, ja miten niihin pääsee sisään &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../584/pythonin-vastaisku-lispeille-ipython-ja-vim-ipython">Pythonin vastaisku lispeille: IPython ja vim-ipython</a></span> &#183; <span class="published">2012-07-25</span>
<br /><span class="smallexcerpt">Tai &#8220;Pythonin uusi toivo&#8221; tai &#8220;Pythonin paluu&#8221;. Mistä on kyse? Pythonin tulkin me kaikki kai tiedämme: kaikki siinä periaatteessa on,...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../581/sumitup-puutteet-ja-mihin-suuntaan-edetaan">SumItUp: puutteet ja mihin suuntaan&#160;edetään</a></span> &#183; <span class="published">2012-07-12</span>
<br /><span class="smallexcerpt">Esittelin pari postausta sitten Soulver-kloonin raakileen, SumItUpin. Nyt se on GitHubissa kaikkien pällisteltävänä ja sellaisella raakileasteella, jotta sitä voi jo...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../579/soulver-kloonia-rakentelemassa">Soulver-kloonia&#160;rakentelemassa</a></span> &#183; <span class="published">2012-07-07</span>
<br /><span class="smallexcerpt">Erittäin upealla konseptilla varustettu laskinohjelma Soulver kaatuu siihen, että sen saa vain Mäkille. Vapaamuotoinen näpertelyalusta on usein ainut asia, mitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../566/terminaaleja-vimista-kasin">Terminaaleja Vimistä&#160;käsin</a></span> &#183; <span class="published">2012-02-11</span>
<br /><span class="smallexcerpt">Vanha kunnon ConqueTerm on nyt valmis ja käyttökelpoinen tuote kehittelyyn.

	Olen viime päivinä alkanut käyttää vimiä hyvin emacsmaisesti. Se on tietenkin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../565/mita-on-kehittaa-clojurella">Mitä on kehittää&#160;Clojurella</a></span> &#183; <span class="published">2012-02-05</span>
<br /><span class="smallexcerpt">C- ja muunkielisissä projekteissa tavataan kirjoittaa koodia ensin, ja sitten testataan. Tietysti vaatimus osittain syntyy koodin kääntämisestä; ilman kääntöä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../564/ranskalaisten-viivojen-parsimista-clojurella">Ranskalaisten viivojen parsimista&#160;Clojurella</a></span> &#183; <span class="published">2012-02-02</span>
<br /><span class="smallexcerpt">Kirjoitin männäviikolla kokeilumielessä ohjelman, joka kääntää ranskalaiset viivat Beamer-Latexiksi. Ideana olisi tuottaa esityksen lihapuoli nopeasti rustaamalla tiivistä merkintää ja sitten...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../556/korintaytto-ja-ahne-menetelma">Korintäyttö ja ahne&#160;menetelmä</a></span> &#183; <span class="published">2011-10-23</span>
<br /><span class="smallexcerpt">Mietiskelen tässä korintäyttöä (bin packing) ja sitä, miten ahne menetelmä on joko ylipolynomiaalinen tai sitten epäoptimaalinen.  Luultavasti se on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../551/tekijoita-clojurella">Tekijöitä&#160;Clojurella</a></span> &#183; <span class="published">2011-09-17</span>
<br /><span class="smallexcerpt">Nyt olen joutunut opiskelemaan tuota lukuteoriaa ja sen alkeita, ja monet niistä teorioista ovat innoittaneet minulle pieniä Clojure-ohjelmia. Se pää...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../547/pieni-tiedostolistausapu">Pieni&#160;tiedostolistausapu</a></span> &#183; <span class="published">2011-09-04</span>
<br /><span class="smallexcerpt">Pitäisi viritellä joku zsh-funktio tekemään seuraavanlaisia tiedostolistauksia nykyisestä hakemistosta:

$ ls -1
foo.txt
bar.txt
paperi.tex
vanhapaperi.tex.gz
$ l .txt
foo.txt
bar.txt
$ l peri
paperi.tex
vanhapaperi.tex.gz
$ l v*p
vanhapaperi.tex.gz
$ ls $files
vanhapaperi.tex.gz


	Eli sen...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>

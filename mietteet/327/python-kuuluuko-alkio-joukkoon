<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


        <!-- standard -->
	<title>Mr. P: Python, kuuluuko alkio joukkoon</title>


	<link rel="home" href="../../index.html" />

	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../../atom/index.html?section=mietteet" />
	<link rel="alternate" type="application/rss+xml" title="RSS 0.92" href="../../rss/index.html?section=mietteet" />

	<link rel="stylesheet" type="text/css" media="screen" href="../../blog.css" />
        <link rel="stylesheet" type="text/css" href="../../codeblock.css" />

            <!-- SyntaxHighlighter: http://alexgorbatchev.com -->
    <script type="text/javascript" src="../../scripts/xregexp-min.js"></script>
    <script type="text/javascript" src="../../scripts/shCore.js"></script>
    <!-- langs -->
    <script type="text/javascript" src="../../scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushClojure.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushHaskell.js"></script>
    <script type="text/javascript" src="../../scripts/shBrushVimscript.js"></script>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../rpc/index.html" />
</head>

<body id="mietteet">

<!-- accessibility -->
<div id="accessibility">
    <ul>
        <li><a href="python-kuuluuko-alkio-joukkoon#content">Siirry sisältöön</a></li>
        <li><a href="python-kuuluuko-alkio-joukkoon#sidebar-2">Siirry hakuun</a></li>
    </ul>
</div>

<div id="container">

<!-- head -->
    <div id="head">
        <h1 id="site-name"><a rel="home" href="../../index.html">Mr. P</a></h1>
        <p id="site-slogan">Asiaa porjoilun tuolta puolen</p>
    </div>

<!-- right -->
    <div id="sidebar-2">
        <ul class="section_list">
	<li>
            
            <a href="../../hetket/index.html">Hetkessä</a>
            
        </li>
	<li>
            
            <a href="../../matematiikka/index.html">Matematiikka</a>
            
        </li>
	<li>
            &raquo;
            <a href="../index.html">Mietteet</a>
            
                <!--<ul>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/598/blogille-idea">Blogille&#160;idea</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/596/org-blogaaminen-vaikeata">Org-blogaaminen&#160;vaikeata</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/595/twitterointia-emacsilla">Twitteröintiä&#160;Emacsilla</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/593/emacsin-salat-alkavat-selvita-org-kovenee-ja-muita-tarinoita">Emacsin salat alkavat selvitä; org kovenee ja muita&#160;tarinoita</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/592/emacs-has-me">Emacs has&#160;me.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/591/editorien-taistelu-tietamyshallinnassa">Editorien taistelu&#160;tietämyshallinnassa</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/590/think-vimorganizer">Think&#160;VimOrganizer.</a>
                </li>
	<li>
                    
                    <a rel="bookmark" href="/mietteet/589/think-orgmode">Think&#160;orgmode.</a>
                </li>
</ul>-->
            
        </li>
</ul>
<!--        <p class="sidebarhead">Aiheita:</p>
        <ul class="category_list">
	<li><a href="/kategoria/hifi/">Hifi</a></li>
	<li><a href="/kategoria/koodaus/">Ohjelmointi</a></li>
	<li><a href="/kategoria/ohjelmistot/">Ohjelmistot</a></li>
	<li><a href="/kategoria/Opiskelu/">Opiskelu</a></li>
	<li><a href="/kategoria/rauta/">Rauta</a></li>
	<li><a href="/kategoria/viihde/">Viihde</a></li>
	<li><a href="/kategoria/Yleistae-turinaa/">Yleistä turinaa</a></li>
</ul> -->

        <p class="sidebarhead">Valikoituja aiheita:</p>
        <ul class="category_list">
	<li><a href="../../tag/blogisäätöä/index.html" class="tagSizeMedium tagSize25" style="font-size: 100%;">blogisäätöä</a></li>
	<li><a href="../../tag/clojure/index.html" class="tagSizeSmallest tagSize1" style="font-size: 100%;">clojure</a></li>
	<li><a href="../../tag/gentoo/index.html" class="tagSizeLargest tagSize105" style="font-size: 100%;">gentoo</a></li>
	<li><a href="../../tag/hifi/index.html" class="tagSizeMedium tagSize31" style="font-size: 100%;">hifi</a></li>
	<li><a href="../../tag/musiikki/index.html" class="tagSizeMedium tagSize23" style="font-size: 100%;">musiikki</a></li>
	<li><a href="../../tag/ohjelmointi/index.html" class="tagSizeMedium tagSize42" style="font-size: 100%;">ohjelmointi</a></li>
	<li><a href="../../tag/ostoksia/index.html" class="tagSizeMedium tagSize11" style="font-size: 100%;">ostoksia</a></li>
	<li><a href="../../tag/palvelin/index.html" class="tagSizeMedium tagSize37" style="font-size: 100%;">palvelin</a></li>
</ul>
        <p><a href="../../tag/index.html">Kaikki tagit</a></p>

        <form method="get" action="../../index.html">
<p class="search_input">Hae<br /><input type="text" value="" name="q" size="15" /></p>
</form>

        <p><a href="../../rss/index.html?section=mietteet" title="RSS 0.92">RSS</a> / <a href="../../atom/index.html?section=mietteet" title="Atom 1.0">Atom</a></p>
        <p class="linklist"><a href="http://textpattern.net/">TextBook</a><br /><a href="http://textpattern.com/">Textpattern</a><br /><a href="http://textpattern.org/">Txp Resources</a><br /><a href="http://twitter.com/progo_" title="Twitter-profiilini">Twitter</a><br /></p>

        <p><a href="http://textpattern.com/"><img src="../../images/2.png" alt="Textpattern CMS" width="105" height="45" /></a></p>
    </div>


<!-- center -->
    <div id="content">



<!-- not tag view, it's the main view -->


        

        <div class="hfeed">
            <!-- five articles to list here, or only one. It depends. -->
            <!-- default form -->

<p class="published">28. heinäkuu 2010, 23:48</p>
<h1 class="entry-title"><a rel="bookmark" href="python-kuuluuko-alkio-joukkoon">Python, kuuluuko alkio&#160;joukkoon</a></h1>


<div class="entry-content">
	<p>Pääsin harjoittamaan kunnolla Pythonin paria funktionaalista rakennetta. Koodissa on tarkoitus selvittää, onko alkiolle määrätyt tagit minkälaisessa kunnossa. Tarkoitus on rakentaa suodatin: jos alkiolla on jokin tagi, mikä on suodinlistalla, pääsee se näkyville. Suotimia säätämällä tietenkin rajaillaan alkioita. Halusin vielä toteuttaa erikseen suotimen &#8220;vähintään yksi riittää&#8221; ja &#8220;kaikkien on täsmättävä&#8221; -toiminnallisuudelle.</p>

	<p>Matemaattisesti nämä <em>Any</em> ja <em>All</em>, vastaavasti, ovat kvanttoreiden säestämiä. <img class="tex" src="http://l.wordpress.com/latex.php?latex=%5Cexists%20x%5Cin%20E%20%3A%20x%20%5Cin%20A&s=1&fg=FFFFFF&bg=000000" alt="\exists x\in E : x \in A" />, missä E on käyttäjän valitsema suodatinkokoelma ja A on tämän testattavan alkion tagijoukko. <em>All</em> on tietenkin vain kvanttorin vaihdos: <img class="tex" src="http://l.wordpress.com/latex.php?latex=%5Cforall%20x%20%5Cin%20E%20%3A%20x%20%5Cin%20A&s=1&fg=FFFFFF&bg=000000" alt="\forall x \in E : x \in A" />, eli matemaattisesti asia on ilmaistavissa hyvin selkein keinoin. Entä imperatiivilla menetelmillä?</p>

	<p><strong>Imperatiivisella paradigmalla</strong> lähtisin kaiketi kaksoissilmukassa käymään ensin filttereitä (joukkoa E) läpi, alisilmukassa sitten testaisin filtteriä sitä alkiota (ja joukkoa A) vastaan. Tapauksessa <em>Any</em> pysäyttäisin heti silmukkatoiston, kun yksikin osuma löytyy. Se on yksinkertainen toteuttaa.</p>

	<p>Tapauksessa <em>All</em> sitten taas pitää kai ylempään silmukkaan asettaa katkaisuehto: jos yksikin filtterin E sisältämistä alkioista ei kuulunut joukkoon A, palautetaan falsea. No, näin järkeiltynä ei sekään mikään sensaatiomaisen monimutkainen ratkaisu ollut.</p>

	<p>Mutta miten tein sen Pythonilla?</p>

<pre class="python">  # Checks if a media item passes filters!
  def passFilter(self, item):
    hash = self.meta[item.GetData()][1]
    tags = self.db.getTags(hash)  # &lt;---  A
    if self.filterType == self.ALL:
      return reduce(lambda x,y: x and y, map(lambda x: x in self.filter, tags))
    elif self.filterType == self.ANY:
      return reduce(lambda x,y: x or y, map(lambda x: x in self.filter, tags))
</pre>

	<p>Kommentteihin merkkasin joukon A, joukko E on <code>self.filter</code>.</p>

	<p>Ylläoleva koodi noudattaa sitten sekä hyviä että huonoja tapoja. Hyviin tapoihin voisi kuulua funktionaalinen lähestysmistapa, huonoihin tuo <code>filterType</code>n käyttö. Se on onneksi helppo fiksata pythonissa.</p>

	<p>Kuka tunteekaan funktiot <a href="http://docs.python.org/library/functions.html#map">map</a> ja <a href="http://docs.python.org/library/functions.html#reduce">reduce</a> tietää, että tämä ratkaisumalli on tehottomampi kuin esittämäni imperatiivinen pseudo. Syy tämän kirjailemiseen onkin toisaalta se, että matemaattinen mallinnustapa oli kirjoittamishetkellä helpompi löytää. Äsken järkeilemäni imperatiivinen tapa olisi nyt helppo kirjailla ylös koodiksi, joten voi olla, että sen teenkin.</p>

	<p>Imperatiivinen toteutus, olettaen, että se toimii, ottaa Any-tapauksessa lähelle O(n):ää (oletetaan vaikka, että tageja on maltillisesti). All-tapauksessa ollaan lähellä O(m*n):ää, mutta silti viivytään kentällä mahdollisimman vähän aikaa. </p>

	<p>Funktionaaliset toteutukseni sen sijaan eivät ainakaan Pythonissa edes yritä optimoitua. Ensin funktio <code>map</code> työstää nimettömän lambdafunktion jokaiselle alkion A tagille. Lambdafunktiossa tarkistetaan joukkoihin kuuluminen; se on hyvällä joukkototeutuksella luokkaa O(log n). Sitten <code>reduce</code> foldaa <code>map</code>in tekemän uuden joukon siten, että kaikki alkiot laitetaan perätysten ja väliin laitetaan haluttu laskutoimitukset täyttävä funktio, tässä tapauksessa <img class="tex" src="http://l.wordpress.com/latex.php?latex=%5Cwedge&s=1&fg=FFFFFF&bg=000000" alt="\wedge" />eli <code>and</code>.</p>

	<p>Eli tyhmä toteutus purkaa lausekkeet auki suoriltaan. Vaikka tapauksessa <em>All</em> tulisi ensimmäisestä joukon E alkiosta hylsy, jatkaa funktionaalinen malli kulkuaan. Eihän se jaksa asiaa tarkastaakaan.</p>

	<p>Haskellilla kirjailtuna sama funktio toimii sitä vastoin todella tehokkaasti; vaativuusluokaksi mutuilen saman kuin esittämälleni pseudo-imperatiiviselle koodille. Syynä on <a href="http://en.wikipedia.org/wiki/Lazy_evaluation">laiska laskenta</a>. Haskell purkaa <code>map</code>-komennon toki auki, mutta ei suorita lambdoja vielä. Sitten kun se vielä purkaa <code>reduce</code>nkin pois (Haskellissa tosin <code>foldr</code>), tuloksena on iso pino laskentaa. Kun nyt esimerkkitapauksessa otetaan ensimmäinen lauseke, ja saadaan <em>False</em>, osataan päätellä <img class="tex" src="http://l.wordpress.com/latex.php?latex=%5Cwedge&s=1&fg=FFFFFF&bg=000000" alt="\wedge" />-merkkien ketjun perusteella koko lausekkeen totuusarvoksi False. Kaikki tämä nopeutus siis sen takia, että Haskell tekee ensin välivaiheen paperille ja vasta lopuksi suorittaa laskutoimitukset. En tiedä, mikä on Pythonin toimintamalli mutta sehän voisi hyvinkin tehdä samaa.</p>

	<p>Lopuksi laitan refaktoroidun, oikeaoppisen version teille. En halua C-tyylisiä roskafunktioita esitellä kaikelle kansalle.</p>

<pre class="python">  # Checks if a media item passes filters!
  # This involves checking filters from the db
  def passFilter(self, item):
    hash = self.meta[item.GetData()][1] 
    tags = self.db.getTags(hash)
    return self.filterFunction(tags)

  def filter_any(self, tags):
      return reduce(lambda x,y: x or y, map(lambda x: x in self.filter, tags))

  def filter_all(self, tags):
      return reduce(lambda x,y: x and y, map(lambda x: x in self.filter, tags))
</pre>

	<p>Ja sitten on erikseen setteri, jolla filtterifunktion voi laittaa. Homma on nyt oikein <em>higher orderia</em> ja melko funktionaalista. Haskellissahan tämä juuri tämänlainen operaatio sujuu prikulleen samanlaisin rivein. Ne vain sijaitsevat vähän eri paikoissa, mutta kun tässäkään ei muuttujiin kosketa, on tämä periaatteessa pelkällä siirtelyllä funktionaalista.</p>
</div>

<p class="tags"> 


Tageja: <a href="../../tag/funktionaalisuus/index.html" rel="tag">funktionaalisuus</a>, 
<a href="../../tag/ohjelmointi/index.html" rel="tag">ohjelmointi</a>, 
<a href="../../tag/python/index.html" rel="tag">python</a>


</p>



<div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>


        </div>

 <!-- now, common stuff -->

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>

        <p><a rel="prev" href="../326/haskell-paassee-viimein-tositoimiin" title="Haskell päässee viimein tositoimiin?">&#171; Haskell päässee viimein tositoimiin?</a> 
           &mdash; <a rel="next" href="../328/toinen-muutto-ja-kohti-absoluuttista-hiljaisuutta" title="Toinen muutto ja kohti absoluuttista hiljaisuutta">Toinen muutto ja kohti absoluuttista hiljaisuutta &#187;</a>
        </p>

        <div class="divider"><img src="../../images/1.gif" alt="---" width="400" height="1" /></div>
        <h2>Aiheen vierestä</h2>
        <ul class="directory">

<li><span class="entry-title"><a rel="bookmark" href="../597/wes-mckinney-python-for-data-analysis-oreilly">Wes McKinney - Python For Data Analysis (O&#39;Reilly)</a></span> &#183; <span class="published">2012-11-30</span>
<br /><span class="smallexcerpt">O&#8217;Reillyn hienon blogiohjelman kautta ilmaiseksi saamani kirja kertoo tyydyttävästi kaikenlaista, mitä Matlabia ja R:ää kammoksuva haluaa tietää! Tässä tapailen mietteitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../594/weboodi-aikataulut-orgiin">WebOodi-aikataulut&#160;orgiin</a></span> &#183; <span class="published">2012-10-23</span>
<br /><span class="smallexcerpt">Itä-Suomen yliopiston weboodissa alkaa olla aika usein kurssi-infot hyvässä kunnossa, ja nyt on myös joensuulaisille olemassa tuota lukkaria, joka on...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../587/tehokkaat-kayttoliittymat-vaivatta">Tehokkaat käyttöliittymät&#160;vaivatta</a></span> &#183; <span class="published">2012-08-16</span>
<br /><span class="smallexcerpt">Ohjelmoijan onni on elää komentorivillä. Tehokkaiden käyttöliittymien rustaaminen on varsin nopeata, kunhan luottaa siihen, että suurta suosiota tuotokset eivät tule...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../584/pythonin-vastaisku-lispeille-ipython-ja-vim-ipython">Pythonin vastaisku lispeille: IPython ja vim-ipython</a></span> &#183; <span class="published">2012-07-25</span>
<br /><span class="smallexcerpt">Tai &#8220;Pythonin uusi toivo&#8221; tai &#8220;Pythonin paluu&#8221;. Mistä on kyse? Pythonin tulkin me kaikki kai tiedämme: kaikki siinä periaatteessa on,...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../581/sumitup-puutteet-ja-mihin-suuntaan-edetaan">SumItUp: puutteet ja mihin suuntaan&#160;edetään</a></span> &#183; <span class="published">2012-07-12</span>
<br /><span class="smallexcerpt">Esittelin pari postausta sitten Soulver-kloonin raakileen, SumItUpin. Nyt se on GitHubissa kaikkien pällisteltävänä ja sellaisella raakileasteella, jotta sitä voi jo...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../579/soulver-kloonia-rakentelemassa">Soulver-kloonia&#160;rakentelemassa</a></span> &#183; <span class="published">2012-07-07</span>
<br /><span class="smallexcerpt">Erittäin upealla konseptilla varustettu laskinohjelma Soulver kaatuu siihen, että sen saa vain Mäkille. Vapaamuotoinen näpertelyalusta on usein ainut asia, mitä...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../566/terminaaleja-vimista-kasin">Terminaaleja Vimistä&#160;käsin</a></span> &#183; <span class="published">2012-02-11</span>
<br /><span class="smallexcerpt">Vanha kunnon ConqueTerm on nyt valmis ja käyttökelpoinen tuote kehittelyyn.

	Olen viime päivinä alkanut käyttää vimiä hyvin emacsmaisesti. Se on tietenkin...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../565/mita-on-kehittaa-clojurella">Mitä on kehittää&#160;Clojurella</a></span> &#183; <span class="published">2012-02-05</span>
<br /><span class="smallexcerpt">C- ja muunkielisissä projekteissa tavataan kirjoittaa koodia ensin, ja sitten testataan. Tietysti vaatimus osittain syntyy koodin kääntämisestä; ilman kääntöä ei...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../564/ranskalaisten-viivojen-parsimista-clojurella">Ranskalaisten viivojen parsimista&#160;Clojurella</a></span> &#183; <span class="published">2012-02-02</span>
<br /><span class="smallexcerpt">Kirjoitin männäviikolla kokeilumielessä ohjelman, joka kääntää ranskalaiset viivat Beamer-Latexiksi. Ideana olisi tuottaa esityksen lihapuoli nopeasti rustaamalla tiivistä merkintää ja sitten...</span>
</li>



<li><span class="entry-title"><a rel="bookmark" href="../556/korintaytto-ja-ahne-menetelma">Korintäyttö ja ahne&#160;menetelmä</a></span> &#183; <span class="published">2011-10-23</span>
<br /><span class="smallexcerpt">Mietiskelen tässä korintäyttöä (bin packing) ja sitä, miten ahne menetelmä on joko ylipolynomiaalinen tai sitten epäoptimaalinen.  Luultavasti se on...</span>
</li>

</ul>

    </div>


<!-- footer -->
	<div id="foot">&nbsp;</div>

</div>

</body>
</html>
